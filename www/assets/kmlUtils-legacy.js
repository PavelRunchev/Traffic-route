System.register(["./index-legacy.js"],(function(e,t){"use strict";var o,r,n,s,i,a,f,l,u,y,c,p,m,d;return{setters:[e=>{o=e.ax,r=e.be,n=e.bf,s=e.ap,i=e.X,a=e.bg,f=e.bh,l=e.bi,u=e.bj,y=e.bk,c=e.bc,p=e.E,m=e.I,d=e.F}],execute:function(){e({S:function(e,t,o=null,r=[]){const n=[],s={},i=t.sublayers,a=new Set(t.folders.map((e=>e.id)));return i.forEach((t=>{const i=new e;if(o?i.read(t,o):i.read(t),r.length&&a.has(i.id)&&(i.visible=r.includes(i.id)),s[t.id]=i,null!=t.parentFolderId&&-1!==t.parentFolderId){const e=s[t.parentFolderId];e.sublayers||(e.sublayers=[]),e.sublayers?.unshift(i)}else n.unshift(i)})),n},b:async function(e){const t=p.fromJSON(e.featureSet).features,o=e.layerDefinition,r=m(o.drawingInfo.renderer),n=d.fromJSON(e.popupInfo),s=[];for(const i of t){const e=await r.getSymbolAsync(i);i.symbol=e,i.popupTemplate=n,i.visible=!0,s.push(i)}return s},d:function(e){const r=e.folders||[],n=r.slice(),s=new Map,i=new Map,a=new Map,f=new Map,l=new Map,u={esriGeometryPoint:i,esriGeometryPolyline:a,esriGeometryPolygon:f};(e.featureCollection?.layers||[]).forEach((e=>{const t=o(e);t.featureSet.features=[];const r=e.featureSet.geometryType;s.set(r,t);const n=e.layerDefinition.objectIdField;"esriGeometryPoint"===r?g(i,n,e.featureSet.features):"esriGeometryPolyline"===r?g(a,n,e.featureSet.features):"esriGeometryPolygon"===r&&g(f,n,e.featureSet.features)})),e.groundOverlays&&e.groundOverlays.forEach((e=>{l.set(e.id,e)})),r.forEach((t=>{t.networkLinkIds.forEach((o=>{const r=function(e,t,o){const r=function(e,t){let o;return t.some((t=>t.id===e&&(o=t,!0))),o}(e,o);return r&&(r.parentFolderId=t,r.networkLink=r),r}(o,t.id,e.networkLinks);r&&n.push(r)}))})),n.forEach((e=>{if(e.featureInfos){e.points=o(s.get("esriGeometryPoint")),e.polylines=o(s.get("esriGeometryPolyline")),e.polygons=o(s.get("esriGeometryPolygon")),e.mapImages=[];for(const o of e.featureInfos)switch(o.type){case"esriGeometryPoint":case"esriGeometryPolyline":case"esriGeometryPolygon":{const r=u[o.type].get(o.id);r&&e[t[o.type]]?.featureSet.features.push(r);break}case"GroundOverlay":{const t=l.get(o.id);t&&e.mapImages.push(t);break}}e.fullExtent=S([e])}}));const y=S(n);return{folders:r,sublayers:n,extent:y}},g:function(e,t,o,a){const f=r?.findCredential(e);e=n(e,{token:f?.token});const l=s.kmlServiceUrl;return i(l,{query:{url:e,model:"simple",folders:"",refresh:0!==o||void 0,outSR:JSON.stringify(t)},responseType:"json",signal:a})},j:S});const t={esriGeometryPoint:"points",esriGeometryPolyline:"polylines",esriGeometryPolygon:"polygons"};function g(e,t,o){o.forEach((o=>{e.set(o.attributes[t],o)}))}function S(e){const t=a(f),o=a(f);for(const r of e){if(r.polygons?.featureSet?.features)for(const e of r.polygons.featureSet.features)l(t,e.geometry),u(o,t);if(r.polylines?.featureSet?.features)for(const e of r.polylines.featureSet.features)l(t,e.geometry),u(o,t);if(r.points?.featureSet?.features)for(const e of r.points.featureSet.features)l(t,e.geometry),u(o,t);if(r.mapImages)for(const e of r.mapImages)l(t,e.extent),u(o,t)}return y(o,f)?void 0:{xmin:o[0],ymin:o[1],zmin:o[2],xmax:o[3],ymax:o[4],zmax:o[5],spatialReference:c.WGS84}}}}}));
