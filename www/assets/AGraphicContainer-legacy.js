System.register(["./index-legacy.js","./TechniqueInstance-legacy.js","./Container-legacy.js","./FeatureCommandQueue-legacy.js","./UpdateTracking2D-legacy.js","./vec3f32-legacy.js","./LabelMetric-legacy.js","./Program-legacy.js","./enums-legacy.js","./ProgramTemplate-legacy.js"],(function(e,t){"use strict";var i,s,n,r,a,o,l,c,u,h,d,g,_,f,m,p,v,y,x,b,M,R,S,B;return{setters:[e=>{i=e.eQ,s=e.g6,n=e.g9,r=e.eJ,a=e.eO,o=e.eK,l=e.eL,c=e.ga,u=e.eM,h=e.K},e=>{d=e.i,g=e.r},e=>{_=e.i,f=e.N},e=>{m=e.h},e=>{p=e.r},e=>{v=e.r},e=>{y=e.b},e=>{x=e.h},e=>{b=e.R,M=e.E,R=e.C,S=e.F},e=>{B=e.o}],execute:function(){let t=0;function O(e,i,s){return new d(p(t++),e,e.meshWriter.name,i,s)}const A={geometry:{visualVariableColor:null,visualVariableOpacity:null,visualVariableSizeMinMaxValue:null,visualVariableSizeScaleStops:null,visualVariableSizeStops:null,visualVariableSizeUnitValue:null,visualVariableRotation:null}};class D{constructor(){this.instances={fill:O(m.fill,A,{zoomRange:!0}),marker:O(m.marker,A,{zoomRange:!0}),line:O(m.line,A,{zoomRange:!0}),text:O(m.text,A,{zoomRange:!0,referenceSymbol:!1,clipAngle:!1}),complexFill:O(m.complexFill,A,{zoomRange:!0}),texturedLine:O(m.texturedLine,A,{zoomRange:!0})},this._instancesById=Object.values(this.instances).reduce(((e,t)=>(e.set(t.instanceId,t),e)),new Map)}getInstance(e){return this._instancesById.get(e)}}const I=Math.PI/180;class C extends _{constructor(e){super(),this._program=null,this._vao=null,this._vertexBuffer=null,this._indexBuffer=null,this._dvsMat3=i(),this._localOrigin={x:0,y:0},this._getBounds=e}destroy(){this._vao&&(this._vao.dispose(),this._vao=null,this._vertexBuffer=null,this._indexBuffer=null),this._program=s(this._program)}doRender(e){const{context:t}=e,i=this._getBounds();if(i.length<1)return;this._createShaderProgram(t),this._updateMatricesAndLocalOrigin(e),this._updateBufferData(t,i),t.setBlendingEnabled(!0),t.setDepthTestEnabled(!1),t.setStencilWriteMask(0),t.setStencilTestEnabled(!1),t.setBlendFunction(b.ONE,b.ONE_MINUS_SRC_ALPHA),t.setColorMask(!0,!0,!0,!0);const s=this._program;t.bindVAO(this._vao),t.useProgram(s),s.setUniformMatrix3fv("u_dvsMat3",this._dvsMat3),t.gl.lineWidth(1),t.drawElements(M.LINES,8*i.length,R.UNSIGNED_INT,0),t.bindVAO()}_createTransforms(){return{displayViewScreenMat3:i()}}_createShaderProgram(e){this._program||(this._program=e.programCache.acquire("precision highp float;\n        uniform mat3 u_dvsMat3;\n\n        attribute vec2 a_position;\n\n        void main() {\n          mediump vec3 pos = u_dvsMat3 * vec3(a_position, 1.0);\n          gl_Position = vec4(pos.xy, 0.0, 1.0);\n        }","precision mediump float;\n      void main() {\n        gl_FragColor = vec4(0.75, 0.0, 0.0, 0.75);\n      }",V().attributes))}_updateMatricesAndLocalOrigin(e){const{state:t}=e,{displayMat3:i,size:s,resolution:h,pixelRatio:d,rotation:g,viewpoint:_}=t,f=I*g,{x:m,y:p}=_.targetGeometry,y=n(m,t.spatialReference);this._localOrigin.x=y,this._localOrigin.y=p;const x=d*s[0],b=d*s[1],M=h*x,R=h*b,S=r(this._dvsMat3);a(S,S,i),o(S,S,l(x/2,b/2)),c(S,S,v(s[0]/M,-b/R,1)),u(S,S,-f)}_updateBufferData(e,t){const{x:i,y:s}=this._localOrigin,n=8*t.length,r=new Float32Array(n),a=new Uint32Array(8*t.length);let o=0,l=0;for(const c of t)c&&(r[2*o]=c[0]-i,r[2*o+1]=c[1]-s,r[2*o+2]=c[0]-i,r[2*o+3]=c[3]-s,r[2*o+4]=c[2]-i,r[2*o+5]=c[3]-s,r[2*o+6]=c[2]-i,r[2*o+7]=c[1]-s,a[l]=o+0,a[l+1]=o+3,a[l+2]=o+3,a[l+3]=o+2,a[l+4]=o+2,a[l+5]=o+1,a[l+6]=o+1,a[l+7]=o+0,o+=4,l+=8);if(this._vertexBuffer?this._vertexBuffer.setData(r.buffer):this._vertexBuffer=x.createVertex(e,S.DYNAMIC_DRAW,r.buffer),this._indexBuffer?this._indexBuffer.setData(a):this._indexBuffer=x.createIndex(e,S.DYNAMIC_DRAW,a),!this._vao){const t=V();this._vao=new B(e,t.attributes,t.bufferLayouts,{geometry:this._vertexBuffer},this._indexBuffer)}}}const V=()=>y("bounds",{geometry:[{location:0,name:"a_position",count:2,type:R.FLOAT}]});e("i",class extends g{constructor(e){super(e),this._instanceStore=new D,this.checkHighlight=()=>!0}destroy(){super.destroy(),this._boundsRenderer=h(this._boundsRenderer)}get instanceStore(){return this._instanceStore}enableRenderingBounds(e){this._boundsRenderer=new C(e),this.requestRender()}get hasHighlight(){return this.checkHighlight()}onTileData(e,t){e.onMessage(t),this.contains(e)||this.addChild(e),this.requestRender()}_renderChildren(e,t){e.selection=t;for(const i of this.children){if(!i.visible)continue;const t=i.getDisplayList(e.drawPhase,this._instanceStore,f.STRICT_ORDER);t?.render(e)}}})}}}));
