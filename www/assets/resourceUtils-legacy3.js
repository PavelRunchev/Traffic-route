System.register(["./index-legacy.js","./resourceUtils-legacy2.js"],(function(e,t){"use strict";var s,r,o,a,c,n,u,p;return{setters:[e=>{s=e.d7,r=e._,o=e.d8,a=e.at,c=e.s,n=e.d9},e=>{u=e.getSiblingOfSameTypeI,p=e.contentToBlob}],execute:function(){async function h(e,n,h){if(!n?.resources)return;const i=n.portalItem===e.portalItem?new Set(e.paths):new Set;e.paths.length=0,e.portalItem=n.portalItem;const l=new Set(n.resources.toKeep.map((e=>e.resource.path))),f=new Set,m=[];l.forEach((t=>{i.delete(t),e.paths.push(t)}));const d=[],w=[],g=[];for(const t of n.resources.toUpdate)if(i.delete(t.resource.path),l.has(t.resource.path)||f.has(t.resource.path)){const{resource:r,content:o,finish:a}=t,c=u(r,s());e.paths.push(c.path),d.push({resource:c,content:await p(o),compress:t.compress}),a&&g.push((()=>a(c)))}else{e.paths.push(t.resource.path),w.push({resource:t.resource,content:await p(t.content),compress:t.compress});const s=t.finish;s&&g.push((()=>s(t.resource))),f.add(t.resource.path)}for(const t of n.resources.toAdd)if(e.paths.push(t.resource.path),i.has(t.resource.path))i.delete(t.resource.path);else{d.push({resource:t.resource,content:await p(t.content),compress:t.compress});const e=t.finish;e&&g.push((()=>e(t.resource)))}if(d.length||w.length){const{addOrUpdateResources:e}=await r((()=>t.import("./resourceUtils-legacy2.js")),void 0,t.meta.url);await e(n.portalItem,d,"add",h),await e(n.portalItem,w,"update",h)}if(g.forEach((e=>e())),0===m.length)return i;const I=await o(m);if(a(h),I.length>0)throw new c("save:resources","Failed to save one or more resources",{errors:I});return i}async function i(e,t,s){if(!e||!t.portalItem)return;const r=[];for(const o of e){const e=t.portalItem.resourceFromPath(o);r.push(e.portalItem.removeResource(e,s))}await n(r)}e({n:async function(e,t,s,r,o){const a=await h(s,r,o);await e.update({data:t}),await i(a,r,o)},p:async function(e,t,s){const r=await h(e,t,s);await i(r,t,s)}})}}}));
