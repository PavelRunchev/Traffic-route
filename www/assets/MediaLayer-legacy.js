System.register(["./index-legacy.js","./imageUtils-legacy2.js","./perspectiveUtils-legacy.js","./mat3f64-legacy.js","./resourceExtension-legacy.js","./BoundsStore-legacy.js","./normalizeUtilsSync-legacy.js","./PooledRBush-legacy.js"],(function(e,t){"use strict";var n,o,r,i,s,l,a,c,u,p,d,h,y,f,m,g,v,P,x,w,R,_,b,S,I,O,j,L,M,E,T,H,A,C,W,N,V,z,G,U,B,F,J,k,D,K,q,$,Q,X,Y,Z,ee,te,ne,oe,re,ie,se,le,ae,ce,ue,pe,de,he,ye,fe,me,ge;return{setters:[e=>{n=e.x,o=e.z,r=e.i4,i=e.dS,s=e.w,l=e.y,a=e.ar,c=e.da,u=e.bc,p=e.eW,d=e.s,h=e.g8,y=e.jG,f=e.bD,m=e.dN,g=e.jH,v=e.jI,P=e.aN,x=e.g5,w=e.bm,R=e.jJ,_=e.aQ,b=e.cL,S=e.jK,I=e.jL,O=e.jM,j=e.dg,L=e.ex,M=e.dv,E=e.b1,T=e.bL,H=e.dt,A=e.dx,C=e.du,W=e.dw,N=e.jN,V=e.dy,z=e.jO,G=e.X,U=e.d7,B=e.bG,F=e.jP,J=e.V,k=e.io,D=e.c7,K=e.C,q=e.at,$=e.O,Q=e.d1,X=e.G,Y=e.b4,Z=e.eS,ee=e.gd,te=e.bs,ne=e.bt,oe=e.de,re=e.df,ie=e.A,se=e.fp,le=e.d_,ae=e.bw,ce=e._},e=>{ue=e.p},e=>{pe=e.p,de=e.j,he=e.m},e=>{ye=e.t,fe=e.e},e=>{me=e.p},e=>{ge=e.o},null,null],execute:function(){let ve=class extends r{projectOrWarn(e,t){if(null==e)return e;const{geometry:n,pending:o}=i(e,t);return o?null:o||n?n:(s.getLogger(this).warn("geometry could not be projected to the spatial reference",{georeference:this,geometry:e,sourceSpatialReference:e.spatialReference,targetSpatialReference:t}),null)}};ve=n([o("esri.layers.support.GeoreferenceBase")],ve);const Pe=ve,xe=fe(),we=x();let Re=class extends w{constructor(){super(...arguments),this.sourcePoint=null,this.mapPoint=null}};n([l()],Re.prototype,"sourcePoint",void 0),n([l({type:a})],Re.prototype,"mapPoint",void 0),Re=n([o("esri.layers.support.ControlPoint")],Re);let _e=class extends(c(Pe)){constructor(e){super(e),this.controlPoints=null,this.height=0,this.type="control-points",this.width=0}readControlPoints(e,t){const n=u.fromJSON(t.spatialReference),o=ye(...t.coefficients,1);return e.map((e=>(p(we,e.x,e.y),pe(we,we,o),{sourcePoint:e,mapPoint:new a({x:we[0],y:we[1],spatialReference:n})})))}writeControlPoints(e,t,n,o){if(null!=this.transform)null!=e&&be(e[0])&&(t.controlPoints=e.map((e=>{const t=e.sourcePoint;return{x:t.x,y:t.y}})),t.spatialReference=e[0].mapPoint.spatialReference.toJSON(),t.coefficients=this.transform.slice(0,8));else{const e=new d("web-document-write:invalid-georeference","Invalid 'controlPoints', 'width', 'height' configuration.",{layer:o?.layer,georeference:this});o?.messages?o.messages.push(e):s.getLogger(this).error(e.name,e.message)}}get coords(){if(null==this.controlPoints)return null;const e=this._updateTransform(xe);if(null==e||!be(this.controlPoints[0]))return null;const t=this.controlPoints[0].mapPoint.spatialReference;return function(e,t,n,o){const r=R(0,n),i=R(0,0),s=R(t,0),l=R(t,n);return pe(r,r,e),pe(i,i,e),pe(s,s,e),pe(l,l,e),new P({rings:[[r,i,s,l,r]],spatialReference:o})}(e,this.width,this.height,t)}set coords(e){if(null==this.controlPoints||!be(this.controlPoints[0]))return;const t=this.controlPoints[0].mapPoint.spatialReference;if(null==(e=this.projectOrWarn(e,t)))return;const{width:n,height:o}=this,{rings:[[r,i,s,l]]}=e,c={sourcePoint:h(0,o),mapPoint:new a({x:r[0],y:r[1],spatialReference:t})},u={sourcePoint:h(0,0),mapPoint:new a({x:i[0],y:i[1],spatialReference:t})},d={sourcePoint:h(n,0),mapPoint:new a({x:s[0],y:s[1],spatialReference:t})},y={sourcePoint:h(n,o),mapPoint:new a({x:l[0],y:l[1],spatialReference:t})};be(c)&&be(u)&&be(d)&&be(y)&&(Ce(xe,c,u,d,y),this.controlPoints=this.controlPoints.map((({sourcePoint:e})=>(p(we,e.x,e.y),pe(we,we,xe),{sourcePoint:e,mapPoint:new a({x:we[0],y:we[1],spatialReference:t})}))))}get inverseTransform(){return null==this.transform?null:y(fe(),this.transform)}get transform(){return this._updateTransform()}toMap(e){if(null==e||null==this.transform||null==this.controlPoints||!be(this.controlPoints[0]))return null;p(we,e.x,e.y);const t=this.controlPoints[0].mapPoint.spatialReference;return pe(we,we,this.transform),new a({x:we[0],y:we[1],spatialReference:t})}toSource(e){if(null==e||null==this.inverseTransform||null==this.controlPoints||!be(this.controlPoints[0]))return null;const t=this.controlPoints[0].mapPoint.spatialReference;return e=e.normalize(),null==(e=i(e,t).geometry)?null:(p(we,e.x,e.y),pe(we,we,this.inverseTransform),h(we[0],we[1]))}toSourceNormalized(e){const t=this.toSource(e);return null!=t&&(t.x/=this.width,t.y/=this.height),t}_updateTransform(e){const{controlPoints:t,width:n,height:o}=this;if(!(null!=t&&n>0&&o>0))return null;const[r,i,s,l]=t;if(!be(r))return null;const a=r.mapPoint.spatialReference,c=this._projectControlPoint(i,a),u=this._projectControlPoint(s,a),p=this._projectControlPoint(l,a);if(!c.valid||!u.valid||!p.valid)return null;if(!be(c.controlPoint))return null;null==e&&(e=fe());let d=null;return d=be(u.controlPoint)&&be(p.controlPoint)?Ce(e,r,c.controlPoint,u.controlPoint,p.controlPoint):be(u.controlPoint)?function(e,t,n,o){return Ae(Se,Le,t),Ae(Ie,Me,n),Ae(Oe,Ee,o),v(je,Se,Ie,.5),g(je,Oe,je,Math.PI),v(Te,Le,Me,.5),g(Te,Ee,Te,Math.PI),ze(e,Se,Ie,Oe,je,Le,Me,Ee,Te)}(e,r,c.controlPoint,u.controlPoint):function(e,t,n){return Ae(Se,Le,t),Ae(Ie,Me,n),g(Oe,Ie,Se,He),g(je,Se,Ie,He),g(Ee,Me,Le,-He),g(Te,Le,Me,-He),ze(e,Se,Ie,Oe,je,Le,Me,Ee,Te)}(e,r,c.controlPoint),d.every((e=>0===e))?null:d}_projectControlPoint(e,t){if(!be(e))return{valid:!0,controlPoint:e};const{sourcePoint:n,mapPoint:o}=e,{geometry:r,pending:l}=i(o,t);return l?{valid:!1,controlPoint:null}:l||r?{valid:!0,controlPoint:{sourcePoint:n,mapPoint:r}}:(s.getLogger(this).warn("map point could not be projected to the spatial reference",{georeference:this,controlPoint:e,sourceSpatialReference:o.spatialReference,targetSpatialReference:t}),{valid:!1,controlPoint:null})}};function be(e){return null!=e?.sourcePoint&&null!=e.mapPoint}n([l({type:[Re],json:{write:{allowNull:!1,isRequired:!0}}})],_e.prototype,"controlPoints",void 0),n([f("controlPoints")],_e.prototype,"readControlPoints",null),n([m("controlPoints")],_e.prototype,"writeControlPoints",null),n([l()],_e.prototype,"coords",null),n([l({json:{write:!0}})],_e.prototype,"height",void 0),n([l({readOnly:!0})],_e.prototype,"inverseTransform",null),n([l({readOnly:!0})],_e.prototype,"transform",null),n([l({json:{write:!0}})],_e.prototype,"width",void 0),_e=n([o("esri.layers.support.ControlPointsGeoreference")],_e);const Se=x(),Ie=x(),Oe=x(),je=x(),Le=x(),Me=x(),Ee=x(),Te=x(),He=Math.PI/2;function Ae(e,t,n){p(e,n.sourcePoint.x,n.sourcePoint.y),p(t,n.mapPoint.x,n.mapPoint.y)}function Ce(e,t,n,o,r){return Ae(Se,Le,t),Ae(Ie,Me,n),Ae(Oe,Ee,o),Ae(je,Te,r),ze(e,Se,Ie,Oe,je,Le,Me,Ee,Te)}const We=new Array(8).fill(0),Ne=new Array(8).fill(0);function Ve(e,t,n,o,r){return e[0]=t[0],e[1]=t[1],e[2]=n[0],e[3]=n[1],e[4]=o[0],e[5]=o[1],e[6]=r[0],e[7]=r[1],e}function ze(e,t,n,o,r,i,s,l,a){return de(e,Ve(We,t,n,o,r),Ve(Ne,i,s,l,a))}const Ge=_e,Ue=x();let Be=class extends Pe{constructor(e){super(e),this.bottomLeft=null,this.bottomRight=null,this.topLeft=null,this.topRight=null,this.type="corners"}get coords(){let{topLeft:e,topRight:t,bottomLeft:n,bottomRight:o}=this;if(null==e||null==t||null==n||null==o)return null;const r=e.spatialReference;return t=this.projectOrWarn(t,r),n=this.projectOrWarn(n,r),o=this.projectOrWarn(o,r),null==t||null==n||null==o?null:new P({rings:[[[n.x,n.y],[e.x,e.y],[t.x,t.y],[o.x,o.y],[n.x,n.y]]],spatialReference:r})}set coords(e){const{topLeft:t}=this;if(null==t)return;const n=t.spatialReference;if(null==(e=this.projectOrWarn(e,n)))return;const{rings:[[o,r,i,s]]}=e;this.bottomLeft=new a({x:o[0],y:o[1],spatialReference:n}),this.topLeft=new a({x:r[0],y:r[1],spatialReference:n}),this.topRight=new a({x:i[0],y:i[1],spatialReference:n}),this.bottomRight=new a({x:s[0],y:s[1],spatialReference:n})}toSourceNormalized(e){const{topLeft:t,topRight:n,bottomRight:o,bottomLeft:r}=this;if(null==e||null==t||null==n||null==o||null==r)return null;const s=t.spatialReference;e=e.normalize();const l=i(e,s).geometry;if(null==l)return null;p(Ue,l.x,l.y);const a=de(fe(),[t.x,t.y,r.x,r.y,n.x,n.y,o.x,o.y],[0,0,0,1,1,0,1,1]);return pe(Ue,Ue,a),h(Ue[0],Ue[1])}};n([l()],Be.prototype,"coords",null),n([l({type:a})],Be.prototype,"bottomLeft",void 0),n([l({type:a})],Be.prototype,"bottomRight",void 0),n([l({type:a})],Be.prototype,"topLeft",void 0),n([l({type:a})],Be.prototype,"topRight",void 0),Be=n([o("esri.layers.support.CornersGeoreference")],Be);const Fe=Be;let Je=class extends Pe{constructor(e){super(e),this.extent=null,this.rotation=0,this.type="extent-and-rotation"}get coords(){if(null==this.extent)return null;const{xmin:e,ymin:t,xmax:n,ymax:o,spatialReference:r}=this.extent;let i;if(this.rotation){const{x:r,y:s}=this.extent.center,l=ke(r,s,this.rotation);i=[l(e,t),l(e,o),l(n,o),l(n,t)],i.push(i[0])}else i=[[e,t],[e,o],[n,o],[n,t],[e,t]];return new P({rings:[i],spatialReference:r})}set coords(e){if(null==e||null==this.extent)return;const t=this.extent.spatialReference;if(e=this.projectOrWarn(e,t),null==e?.extent)return;const{rings:[[n,o,r]],extent:{center:{x:i,y:s}}}=e,l=b(Math.PI/2-Math.atan2(o[1]-n[1],o[0]-n[0])),a=ke(i,s,-l),[c,u]=a(n[0],n[1]),[p,d]=a(r[0],r[1]);this.extent=new _({xmin:c,ymin:u,xmax:p,ymax:d,spatialReference:t}),this.rotation=l}toSourceNormalized(e){const{extent:t,rotation:n}=this;if(null==e||null==t)return null;const{xmin:o,ymin:r,xmax:s,ymax:l,center:a,spatialReference:c}=t;e=e.normalize();const u=i(e,c).geometry;if(null==u)return null;let p=u.x,d=u.y;return n&&([p,d]=ke(a.x,a.y,-n)(p,d)),h(S(p,o,s,0,1),S(d,l,r,0,1))}};function ke(e,t,n){const o=I(n),r=Math.cos(o),i=Math.sin(o);return(n,o)=>[r*(n-e)+i*(o-t)+e,r*(o-t)-i*(n-e)+t]}n([l()],Je.prototype,"coords",null),n([l({type:_})],Je.prototype,"extent",void 0),n([l({type:Number})],Je.prototype,"rotation",void 0),Je=n([o("esri.layers.support.ExtentAndRotationGeoreference")],Je);const De={key:"type",base:Pe,typeMap:{"control-points":Ge,corners:Fe,"extent-and-rotation":Je}},Ke={key:"type",base:Pe,typeMap:{"control-points":Ge}};let qe=class extends(O(j(L))){constructor(e){super(e),this.georeference=null,this.opacity=1}readGeoreference(e){return Ge.fromJSON(e)}get contentWidth(){return 0}get contentHeight(){return 0}toSource(e){const{georeference:t,contentWidth:n,contentHeight:o}=this;if(null==e||null==t||0===n||0===o)return null;const r=t.toSourceNormalized(e);return null==r?null:(r.x*=n,r.y*=o,r)}};n([l({types:De,json:{write:!0,types:Ke}})],qe.prototype,"georeference",void 0),n([f("georeference")],qe.prototype,"readGeoreference",null),n([l({json:{read:!1,write:!1}})],qe.prototype,"opacity",void 0),qe=n([o("esri.layers.support.MediaElementBase")],qe);const $e=qe;function Qe(e,t){const n=M(t);return function(e){return"media"===e?.type}(e)&&!!e.portalItem&&null!=n&&n>E.PORTAL_ITEM}let Xe=class extends $e{constructor(e){super(e),this.animationOptions=null,this.content=null,this.image=null,this.type="image",this.image=null}load(){const e=this.image;if("string"==typeof e){const t=ue(e).then((e=>{this._set("content",e)}));this.addResolvingPromise(t)}else if(e instanceof HTMLImageElement){const t=e.decode().then((()=>{this._set("content",e)}));this.addResolvingPromise(t)}else e?this._set("content",e):this.addResolvingPromise(Promise.reject(new d("image-element:invalid-image-type","Invalid image type",{image:e})));return Promise.resolve(this)}get contentWidth(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalWidth:this.content.width}get contentHeight(){return null==this.content?0:this.content instanceof HTMLImageElement?this.content.naturalHeight:this.content.height}readImage(e,t,n){return T(t.url,n)}writeImage(e,t,n,o){if(null==e)return;const r=o?.portalItem,i=o?.resources;if(!r||!i)return void("string"==typeof e&&(t[n]=H(e,o)));const s=function(e){return"string"==typeof e&&!N(e)&&!V(e)}(e)?e:null;if(s){if(null==A(s))return void(t[n]=s);const e=H(s,{...o,verifyItemRelativeUrls:o?.verifyItemRelativeUrls?{writtenUrls:o.verifyItemRelativeUrls.writtenUrls,rootPath:void 0}:void 0},C.NO);if(r&&e&&!W(e))return i.toKeep.push({resource:r.resourceFromPath(e),compress:!1}),void(t[n]=e)}t[n]="<pending>",i.pendingOperations.push(async function(e){return"string"==typeof e?N(e)?z(e):(await G(e,{responseType:"blob"})).data:new Promise((t=>function(e){if(e instanceof HTMLCanvasElement)return e;const t=e instanceof HTMLImageElement?e.naturalWidth:e.width,n=e instanceof HTMLImageElement?e.naturalHeight:e.height,o=document.createElement("canvas"),r=o.getContext("2d");return o.width=t,o.height=n,e instanceof HTMLImageElement?r.drawImage(e,0,0,e.width,e.height):e instanceof ImageData&&r.putImageData(e,0,0),o}(e).toBlob(t)))}(e).then((e=>{const o=function(e,t){const n=U(),o=`${B("media",n)}.${me({type:"blob",blob:e})}`;return t.resourceFromPath(o)}(e,r);t[n]=o.itemRelativeUrl,i.toAdd.push({resource:o,content:{type:"blob",blob:e},compress:!1,finish:e=>{this.image=e.url}})})))}write(e,t){const n=super.write(e,t);return"mediaType"in n&&!n.url&&delete n.mediaType,n}};n([l()],Xe.prototype,"animationOptions",void 0),n([l({readOnly:!0})],Xe.prototype,"content",void 0),n([l({readOnly:!0})],Xe.prototype,"contentWidth",null),n([l({readOnly:!0})],Xe.prototype,"contentHeight",null),n([l({json:{name:"url",type:String,write:{overridePolicy:(e,t,n)=>({enabled:!Qe(n?.layer,n?.origin)})}}})],Xe.prototype,"image",void 0),n([f("image",["url"])],Xe.prototype,"readImage",null),n([m("image")],Xe.prototype,"writeImage",null),n([l({readOnly:!0,json:{read:!1,write:{target:"mediaType",ignoreOrigin:!0}}})],Xe.prototype,"type",void 0),Xe=n([o("esri.layers.support.ImageElement")],Xe);const Ye=Xe;let Ze=class extends $e{constructor(e){super(e),this.autoplay=!0,this.content=null,this.type="video"}load(){const e=this.video;if("string"==typeof e){const t=document.createElement("video");t.src=e,t.crossOrigin="anonymous",t.autoplay=!0,t.muted=!0,t.loop=!0,this.addResolvingPromise(this._loadVideo(t).then((()=>{this._set("content",t)})))}else e instanceof HTMLVideoElement?this.addResolvingPromise(this._loadVideo(e).then((()=>{this._set("content",e)}))):this.addResolvingPromise(Promise.reject(new d("video-element:invalid-video-type","Invalid video type",{video:e})));return Promise.resolve(this)}get contentWidth(){return this.content?.videoWidth??0}get contentHeight(){return this.content?.videoHeight??0}set video(e){"not-loaded"===this.loadStatus?this._set("video",e):s.getLogger(this).error("#video","video cannot be changed after the element is loaded.")}_loadVideo(e){return new Promise(((t,n)=>{const o=F(e,"canplay",(()=>{this.removeHandles("canplay"),this.autoplay?e.play().then(t,n):t()}));this.addHandles(o,"canplay"),"anonymous"!==e.crossOrigin&&(e.crossOrigin="anonymous",e.src?.includes("blob:")||(e.src=e.src))}))}};n([l()],Ze.prototype,"autoplay",void 0),n([l({readOnly:!0})],Ze.prototype,"content",void 0),n([l({readOnly:!0})],Ze.prototype,"contentWidth",null),n([l({readOnly:!0})],Ze.prototype,"contentHeight",null),n([l()],Ze.prototype,"video",null),Ze=n([o("esri.layers.support.VideoElement")],Ze);const et=Ze,tt={key:"type",defaultKeyValue:"image",base:$e,typeMap:{image:Ye,video:et}},nt=J.ofType(tt);let ot=class extends(L.LoadableMixin(k(D.EventedAccessor))){constructor(e){super(e),this._index=new ge,this._elementViewsMap=new Map,this._elementsIndexes=new Map,this._elementsChangedHandler=e=>{for(const n of e.removed){const e=this._elementViewsMap.get(n);this._elementViewsMap.delete(n),this._index.delete(e),this.removeHandles(e),e.destroy(),this.notifyChange("fullExtent")}const{spatialReference:t}=this;for(const n of e.added){if(this._elementViewsMap.get(n))continue;const e=new he({spatialReference:t,element:n});this._elementViewsMap.set(n,e);const o=K((()=>e.coords),(()=>this._updateIndexForElement(e,!1)));this._updateIndexForElement(e,!0),this.addHandles(o,e)}this._elementsIndexes.clear(),this.elements.forEach(((e,t)=>this._elementsIndexes.set(e,t))),this.emit("refresh")},this.elements=new nt}async load(e){if(q(e),!this.spatialReference){const e=this.elements.find((e=>null!=e.georeference?.coords));this._set("spatialReference",e?e.georeference.coords.spatialReference:u.WGS84)}return this._elementsChangedHandler({added:this.elements.items,removed:[]}),this.addHandles(this.elements.on("change",this._elementsChangedHandler)),this}destroy(){this._index.clear(),this._elementViewsMap.clear(),this._elementsIndexes.clear()}set elements(e){this._set("elements",$(e,this._get("elements"),nt))}get fullExtent(){if("not-loaded"===this.loadStatus)return null;const e=this._index.fullBounds;return null==e?null:new _({xmin:e[0],ymin:e[1],xmax:e[2],ymax:e[3],spatialReference:this.spatialReference})}set spatialReference(e){"not-loaded"===this.loadStatus?this._set("spatialReference",e):s.getLogger(this).error("#spatialReference","spatialReference cannot be changed after the source is loaded.")}async queryElements(e,t){await this.load(),await Q(e.spatialReference,this.spatialReference,null,t);const n=X(e.spatialReference,this.spatialReference)?e:Y(e,this.spatialReference);if(!n)return[];const o=n.normalize(),r=[];for(const i of o)this._index.forEachInBounds(Z(i),(({normalizedCoords:e,element:t})=>{null!=e&&ee(i,e)&&r.push(t)}));return r.sort(((e,t)=>this._elementsIndexes.get(e)-this._elementsIndexes.get(t))),r}_updateIndexForElement(e,t){const n=e.normalizedBounds,o=this._index.has(e),r=null!=n;this._index.delete(e),r&&this._index.set(e,n),this.notifyChange("fullExtent"),t||(o!==r?this.emit("refresh"):this.emit("change",{element:e.element}))}};n([l()],ot.prototype,"elements",null),n([l({readOnly:!0})],ot.prototype,"fullExtent",null),n([l()],ot.prototype,"spatialReference",null),ot=n([o("esri.layers.support.LocalMediaElementSource")],ot);const rt=ot;function it(e){return"object"==typeof e&&null!=e&&"type"in e}function st(e){return it(e)&&"image"===e.type}let lt=class extends(te(ne(oe(re(j(ae)))))){constructor(e){super(e),this.effectiveSource=null,this.georeference=null,this.copyright=null,this.operationalLayerType="MediaLayer",this.spatialReference=null,this.type="media",this._debouncedSaveOperations=ie((async(e,n,o)=>{const{save:r,saveAs:i}=await ce((()=>t.import("./mediaLayerUtils-legacy.js")),void 0,t.meta.url);switch(e){case se.SAVE:return r(this,n);case se.SAVE_AS:return i(this,o,n)}})),this.source=new rt}load(e){return this.addResolvingPromise(this._doLoad(e)),Promise.resolve(this)}async _doLoad(e){await this.loadFromPortal({supportedTypes:["Media Layer"]},e);let t=this.source;if(!t)throw new d("media-layer:source-missing","Set 'MediaLayer.source' before loading the layer.");const n=this._getSourceOverride(t,this.georeference);n&&(this.setAtOrigin("source",n,"web-map"),t=n);const o=it(t)?new rt({elements:new J([t])}):t;this._set("effectiveSource",o),this.spatialReference&&(o.spatialReference=this.spatialReference),await o.load(e),this.spatialReference=o.spatialReference}destroy(){this.effectiveSource?.destroy(),this.source?.destroy()}readGeoreference(e,t){return e&&"itemId"in t&&t.itemId?e:void 0}get fullExtent(){return this.loaded?this.effectiveSource.fullExtent:null}set source(e){"loaded"!==this.loadStatus&&"failed"!==this.loadStatus?this._set("source",e):s.getLogger(this).error("#source","source cannot be changed after the layer is loaded.")}castSource(e){return e?Array.isArray(e)?new rt({elements:new J(e)}):e instanceof J?new rt({elements:e}):e:null}readSource(e,t,n){if("itemId"in t&&t.itemId)return;const o=this._createSource(t);return o?.read(t,n),o}writeSource(e,t,n,o){st(e)?e.write(t,o):o?.messages&&o?.messages?.push(new d("media-layer:unsupported-source","source must be an 'ImageElement'"))}async save(e){return this._debouncedSaveOperations(se.SAVE,e)}async saveAs(e,t){return this._debouncedSaveOperations(se.SAVE_AS,t,e)}_createSource(e){if("mediaType"in e)switch(e.mediaType){case"image":return new Ye;case"video":return new et}return null}_getSourceOverride(e,t){if(it(e)&&this.originIdOf("source")===E.PORTAL_ITEM&&t&&this.originIdOf("georeference")===E.WEB_MAP){const n=e.toJSON(),o=this._createSource(n);return o.read({...n},{origin:"portal-item"}),o.read({georeference:t},{origin:"web-map"}),o}return null}};n([l({readOnly:!0})],lt.prototype,"effectiveSource",void 0),n([l({readOnly:!0,json:{read:!1,write:!1,origins:{"web-map":{read:!0,write:!1}}}})],lt.prototype,"georeference",void 0),n([f("web-map","georeference")],lt.prototype,"readGeoreference",null),n([l({type:String})],lt.prototype,"copyright",void 0),n([l({readOnly:!0})],lt.prototype,"fullExtent",null),n([l({type:["MediaLayer"]})],lt.prototype,"operationalLayerType",void 0),n([l({type:["show","hide"]})],lt.prototype,"listMode",void 0),n([l({nonNullable:!0,json:{write:{enabled:!0,allowNull:!1,overridePolicy(e,t,n){return{enabled:!0,allowNull:!1,ignoreOrigin:Qe(this,n?.origin)&&st(e)&&!!e.georeference&&e.originIdOf("georeference")>E.PORTAL_ITEM}}}}})],lt.prototype,"source",null),n([le("source")],lt.prototype,"castSource",null),n([f("source",["url"])],lt.prototype,"readSource",null),n([m("source")],lt.prototype,"writeSource",null),n([l()],lt.prototype,"spatialReference",void 0),n([l({readOnly:!0})],lt.prototype,"type",void 0),lt=n([o("esri.layers.MediaLayer")],lt),e("default",lt)}}}));
