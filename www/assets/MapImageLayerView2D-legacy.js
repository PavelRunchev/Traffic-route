System.register(["./index-legacy.js","./BitmapContainer-legacy.js","./LayerView-legacy.js","./GraphicsView2D-legacy.js","./HighlightGraphicContainer-legacy.js","./ExportStrategy-legacy.js","./ExportImageParameters-legacy.js","./RefreshableLayerView-legacy.js","./drapedUtils-legacy.js","./WGLContainer-legacy.js","./definitions-legacy.js","./LabelMetric-legacy.js","./enums-legacy.js","./enums-legacy2.js","./Texture-legacy.js","./Program-legacy.js","./VertexElementDescriptor-legacy.js","./ProgramTemplate-legacy.js","./Container-legacy.js","./highlightReasons-legacy.js","./StyleDefinition-legacy.js","./config-legacy.js","./earcut-legacy.js","./featureConversionUtils-legacy.js","./OptimizedGeometry-legacy.js","./OptimizedFeatureSet-legacy.js","./UpdateTracking2D-legacy.js","./TurboLine-legacy.js","./GeometryUtils-legacy.js","./Rect-legacy.js","./BindType-legacy.js","./Util-legacy.js","./constants-legacy.js","./AttributeStore-legacy.js","./TimeOnly-legacy.js","./timeSupport-legacy.js","./json-legacy.js","./FeatureCommandQueue-legacy.js","./normalizeUtilsSync-legacy.js","./AGraphicContainer-legacy.js","./TechniqueInstance-legacy.js","./TileContainer-legacy.js","./vec3f32-legacy.js","./Bitmap-legacy.js","./floorFilterUtils-legacy.js","./sublayerUtils-legacy.js","./popupUtils-legacy.js"],(function(e,t){"use strict";var i,a,s,l,r,n,h,o,g,p,u,c,y,d,m,j,f,x;return{setters:[e=>{i=e.x,a=e.y,s=e.bl,l=e.z,r=e.j,n=e.o,h=e.w,o=e.C},e=>{g=e.a},e=>{p=e.m,u=e.u},e=>{c=e.$},e=>{y=e.h},e=>{d=e.v},e=>{m=e.m},e=>{j=e.i},e=>{f=e.U,x=e.r},null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){const t=e=>{let t=class extends e{initialize(){this.exportImageParameters=new m({layer:this.layer})}destroy(){this.exportImageParameters.destroy(),this.exportImageParameters=null}get floors(){return this.view?.floors??null}get exportImageVersion(){return this.exportImageParameters?.commitProperty("version"),this.commitProperty("timeExtent"),this.commitProperty("floors"),(this._get("exportImageVersion")||0)+1}canResume(){return!!super.canResume()&&!this.timeExtent?.isEmpty}};return i([a()],t.prototype,"exportImageParameters",void 0),i([a({readOnly:!0})],t.prototype,"floors",null),i([a({readOnly:!0})],t.prototype,"exportImageVersion",null),i([a()],t.prototype,"layer",void 0),i([a()],t.prototype,"suspended",void 0),i([a(s)],t.prototype,"timeExtent",void 0),t=i([l("esri.views.layers.MapImageLayerView")],t),t};let w=class extends(t(j(p(u)))){constructor(){super(...arguments),this._highlightGraphics=new r,this._updateHash=""}fetchPopupFeaturesAtLocation(e,t){return this._popupHighlightHelper.fetchPopupFeaturesAtLocation(e,t)}update(e){const t=`${this.exportImageVersion}/${e.state.id}/${e.pixelRatio}/${e.stationary}`;this._updateHash!==t&&(this._updateHash=t,this.strategy.update(e).catch((e=>{n(e)||h.getLogger(this).error(e)})),e.stationary&&this._popupHighlightHelper.updateHighlightedFeatures(e.state.resolution)),this._highlightView.processUpdate(e)}attach(){const{imageMaxWidth:e,imageMaxHeight:t,version:i}=this.layer,a=i>=10.3,s=i>=10;this._bitmapContainer=new g,this.container.addChild(this._bitmapContainer),this._highlightView=new c({view:this.view,graphics:this._highlightGraphics,requestUpdateCallback:()=>this.requestUpdate(),container:new y(this.view.featuresTilingScheme),defaultPointSymbolEnabled:!1}),this.container.addChild(this._highlightView.container),this._popupHighlightHelper=new f({createFetchPopupFeaturesQueryGeometry:(e,t)=>x(e,t,this.view),highlightGraphics:this._highlightGraphics,highlightGraphicUpdated:(e,t)=>{this._highlightView.graphicUpdateHandler({graphic:e,property:t})},layerView:this,updatingHandles:this._updatingHandles}),this.strategy=new d({container:this._bitmapContainer,fetchSource:this.fetchImageBitmap.bind(this),requestUpdate:this.requestUpdate.bind(this),imageMaxWidth:e,imageMaxHeight:t,imageRotationSupported:a,imageNormalizationSupported:s,hidpi:!0}),this.addAttachHandles(o((()=>this.exportImageVersion),(()=>this.requestUpdate()))),this.requestUpdate()}detach(){this.strategy.destroy(),this.container.removeAllChildren(),this._bitmapContainer.removeAllChildren(),this._highlightView.destroy(),this._popupHighlightHelper.destroy()}moveStart(){}viewChange(){}moveEnd(){this.requestUpdate()}supportsSpatialReference(e){return this.layer.serviceSupportsSpatialReference(e)}async doRefresh(){this._updateHash="",this.requestUpdate()}isUpdating(){return this.strategy.updating||this.updateRequested}fetchImage(e,t,i,a){return this.layer.fetchImage(e,t,i,{timeExtent:this.timeExtent,floors:this.floors,...a})}fetchImageBitmap(e,t,i,a){return this.layer.fetchImageBitmap(e,t,i,{timeExtent:this.timeExtent,floors:this.floors,...a})}highlight(e){return this._popupHighlightHelper.highlight(e)}};i([a()],w.prototype,"strategy",void 0),i([a()],w.prototype,"updating",void 0),w=i([l("esri.views.2d.layers.MapImageLayerView2D")],w),e("default",w)}}}));
