System.register(["./index-legacy.js","./DoubleArray-legacy.js","./MeshLocalVertexSpace-legacy.js","./vec3-legacy.js","./sphere-legacy.js","./I3SUtil-legacy.js","./ObjectStack-legacy.js","./plane-legacy.js","./mat3f64-legacy.js","./mat4f64-legacy.js","./quatf64-legacy.js","./computeTranslationToOriginAndRotation-legacy.js","./I3SBinaryReader-legacy.js","./VertexAttribute-legacy.js","./symbolColorUtils-legacy.js","./orientedBoundingBox-legacy.js","./quat-legacy.js"],(function(e,t){"use strict";var n,r,o,i,a,s,l,c;return{setters:[e=>{n=e._,r=e.h8,o=e.bc},e=>{i=e.y},e=>{a=e.i,s=e.a},e=>{l=e.n,c=e.s},null,null,null,null,null,null,null,null,null,null,null,null,null],execute:function(){var f,u;function d(e){return r(`esri/libs/i3s/${e}`)}let y;var m,h,g,b,p;let w,E;function S(e){if(!E)return;const t=e.modifications,n=E._malloc(8*t.length),r=new Float64Array(E.HEAPU8.buffer,n,t.length);for(let o=0;o<t.length;++o)r[o]=t[o];E.setModifications(e.context,n,t.length,e.isGeodetic),E._free(n)}function j(e,t,n){const{context:r,localOrigin:o,globalTrafo:i,mbs:a,obbData:s,elevationOffset:l,geometryBuffer:c,geometryDescriptor:u,indexToVertexProjector:d,vertexToRenderProjector:y}=t,m=e._malloc(c.byteLength),h=e._malloc(33*Float64Array.BYTES_PER_ELEMENT),g=new Uint8Array(e.HEAPU8.buffer,m,c.byteLength);g.set(new Uint8Array(c));const b=new Float64Array(e.HEAPU8.buffer,h,33);L(b,o);let p=b.byteOffset+3*b.BYTES_PER_ELEMENT,w=new Float64Array(b.buffer,p);L(w,i),p+=16*b.BYTES_PER_ELEMENT,w=new Float64Array(b.buffer,p),L(w,a),p+=4*b.BYTES_PER_ELEMENT,s&&(w=new Float64Array(b.buffer,p),L(w,s));const E=u,S={isDraco:!1,isLegacy:!1,color:t.layouts.some((e=>e.some((e=>"color"===e.name)))),normal:t.needNormals&&t.layouts.some((e=>e.some((e=>"normalCompressed"===e.name)))),uv0:t.layouts.some((e=>e.some((e=>"uv0"===e.name)))),uvRegion:t.layouts.some((e=>e.some((e=>"uvRegion"===e.name)))),featureIndex:E.featureIndex},j=e.process(r,!!t.obbData,m,g.byteLength,E,S,h,l,d,y,t.normalReferenceFrame);if(e._free(h),e._free(m),j.error.length>0)throw new Error(`i3s.wasm: ${j.error}`);if(j.discarded)return null;const A=j.componentOffsets.length>0?j.componentOffsets.slice():null,I=j.featureIds.length>0?j.featureIds.slice():null,U=j.anchorIds.length>0?Array.from(j.anchorIds):null,x=j.anchors.length>0?Array.from(j.anchors):null,R=j.interleavedVertedData.slice().buffer,v=j.indicesType===f.Int16?new Uint16Array(j.indices.buffer,j.indices.byteOffset,j.indices.byteLength/2).slice():new Uint32Array(j.indices.buffer,j.indices.byteOffset,j.indices.byteLength/4).slice(),M=j.positions.slice(),O=j.positionIndicesType===f.Int16?new Uint16Array(j.positionIndices.buffer,j.positionIndices.byteOffset,j.positionIndices.byteLength/2).slice():new Uint32Array(j.positionIndices.buffer,j.positionIndices.byteOffset,j.positionIndices.byteLength/4).slice(),F={layout:t.layouts[0],interleavedVertexData:R,indices:v,hasColors:j.hasColors,hasModifications:j.hasModifications,positionData:{data:M,indices:O}};return I&&n.push(I.buffer),A&&n.push(A.buffer),n.push(R),n.push(v.buffer),n.push(M.buffer),n.push(O.buffer),{componentOffsets:A,featureIds:I,anchorIds:U,anchors:x,transformedGeometry:F,obb:j.obb}}function A(e){if(!E)return;const{context:t,buffer:n}=e,r=E._malloc(n.byteLength),o=n.byteLength/Float64Array.BYTES_PER_ELEMENT,i=new Float64Array(E.HEAPU8.buffer,r,o),a=new Float64Array(n);i.set(a),E.filterOBBs(t,r,o),a.set(i),E._free(r)}function I(e){E&&0===E.destroy(e)&&(E=null)}function L(e,t){for(let n=0;n<t.length;++n)e[n]=t[n]}function U(){return E?Promise.resolve(E):(w||(w=(y||(y=new Promise((e=>n((()=>t.import("./i3s-legacy.js")),void 0,t.meta.url).then((e=>e.i)).then((({default:t})=>{const n=t({locateFile:d,onRuntimeInitialized:()=>e(n)});delete n.then})))).catch((e=>{throw e}))),y).then((e=>(E=e,w=null,E)))),w)}e({destroyContext:function(e){I(e)},dracoDecompressPointCloudData:async function(e){E=await U();const t=[e.geometryBuffer],{geometryBuffer:n}=e,r=n.byteLength,o=E._malloc(r),i=new Uint8Array(E.HEAPU8.buffer,o,r);i.set(new Uint8Array(n));const a=E.dracoDecompressPointCloudData(o,i.byteLength);if(E._free(o),a.error.length>0)throw new Error(`i3s.wasm: ${a.error}`);const s=a.featureIds?.length>0?a.featureIds.slice():null,l=a.positions.slice();return s&&t.push(s.buffer),t.push(l.buffer),{result:{positions:l,featureIds:s},transferList:t}},filterObbsForModifications:async function(e){await U(),A(e);const t={buffer:e.buffer};return{result:t,transferList:[t.buffer]}},filterObbsForModificationsSync:A,initialize:async function(){E||await U()},interpretObbModificationResults:function(e){return 0===e?h.Unmodified:1===e?h.PotentiallyModified:2===e?h.Culled:h.Unknown},process:async function(e){E=await U();const t=[e.geometryBuffer];return{result:j(E,e,t),transferList:t}},project:async function(e){const{localMatrix:r,origin:l,positions:c,vertexSpace:f,localMode:u}=e,d=o.fromJSON(e.inSpatialReference),y=o.fromJSON(e.outSpatialReference);let m;if("georeferenced"===f.type&&null==f.origin){const[{projectBuffer:e},{initializeProjection:r}]=await Promise.all([n((()=>t.import("./index-legacy.js").then((e=>e.nb))),void 0,t.meta.url),n((()=>t.import("./index-legacy.js").then((e=>e.nc))),void 0,t.meta.url)]);await r(d,y),m=new Float64Array(c.length),e(c,d,0,m,y,0,m.length/3)}else{const e="georeferenced"===f.type?a.fromJSON(f):s.fromJSON(f),{project:o}=await n((()=>t.import("./georeference-legacy.js").then((e=>e.g))),void 0,t.meta.url);m=i(o({positions:c,transform:r?{localMatrix:r}:void 0,vertexSpace:e,inSpatialReference:d,outSpatialReference:y,localMode:u}))}const h=m.length,[g,b,p]=l;for(let t=0;t<h;t+=3)m[t]-=g,m[t+1]-=b,m[t+2]-=p;return{result:{projected:m,original:c},transferList:[m.buffer,c.buffer]}},setLegacySchema:async function(e){E=await U(),E.setLegacySchema(e.context,e.jsonSchema)},setModifications:async function(e){await U(),S(e)},setModificationsSync:S,transformNormals:async function({normalMatrix:e,normals:t}){const n=new Float32Array(t.length);return l(n,t,e),c(n,n),{result:{transformed:n,original:t},transferList:[n.buffer,t.buffer]}}}),function(e){e[e.None=0]="None",e[e.Int16=1]="Int16",e[e.Int32=2]="Int32"}(f||(f={})),function(e){e[e.Replace=0]="Replace",e[e.Outside=1]="Outside",e[e.Inside=2]="Inside",e[e.Finished=3]="Finished"}(u||(u={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.Culled=1]="Culled",e[e.NotChecked=2]="NotChecked"}(m||(m={})),function(e){e[e.Unmodified=0]="Unmodified",e[e.PotentiallyModified=1]="PotentiallyModified",e[e.Culled=2]="Culled",e[e.Unknown=3]="Unknown",e[e.NotChecked=4]="NotChecked"}(h||(h={})),function(e){e[e.Unknown=0]="Unknown",e[e.Uncached=1]="Uncached",e[e.Cached=2]="Cached"}(g||(g={})),function(e){e[e.None=0]="None",e[e.MaxScreenThreshold=1]="MaxScreenThreshold",e[e.ScreenSpaceRelative=2]="ScreenSpaceRelative",e[e.RemovedFeatureDiameter=3]="RemovedFeatureDiameter",e[e.DistanceRangeFromDefaultCamera=4]="DistanceRangeFromDefaultCamera"}(b||(b={})),function(e){e[e.Hole=0]="Hole",e[e.Leaf=1]="Leaf"}(p||(p={})),e("test",{transform:(e,t)=>E&&j(E,e,t),destroy:I})}}}));
