System.register(["./index-legacy.js","./Util-legacy.js","./ObjectStack-legacy.js","./lineSegment-legacy.js","./plane-legacy.js"],(function(t,i){"use strict";var e,n,s,r,h,a,c,l,o,u,d,m;return{setters:[t=>{e=t.bo,n=t.cu,s=t.cQ,r=t.h7,h=t.ct,a=t.h6,c=t.cS,l=t.gW,o=t.cq},t=>{u=t.s},t=>{d=t.s},t=>{m=t.v},null],execute:function(){var i;t("d",(function(t,i,e){return c(M,i,t),c(b,e,t),.5*l(o(M,M,b))})),t("e",i),function(t){t[t.Layer=0]="Layer",t[t.Object=1]="Object",t[t.Mesh=2]="Mesh",t[t.Line=3]="Line",t[t.Point=4]="Point",t[t.Material=5]="Material",t[t.Texture=6]="Texture",t[t.COUNT=7]="COUNT"}(i||t("e",i={}));class p{constructor(t,i,e){this.primitiveIndices=t,this._numIndexPerPrimitive=i,this.position=e,this._children=void 0,u(t.length>=1),u(3===e.size||4===e.size);const{data:a,size:c,indices:l}=e;u(l.length%this._numIndexPerPrimitive==0),u(l.length>=t.length*this._numIndexPerPrimitive);const o=t.length;let d=c*l[this._numIndexPerPrimitive*t[0]];x.clear(),x.push(d);const m=n(a[d],a[d+1],a[d+2]),p=s(m);for(let n=0;n<o;++n){const i=this._numIndexPerPrimitive*t[n];for(let t=0;t<this._numIndexPerPrimitive;++t){d=c*l[i+t],x.push(d);let e=a[d];m[0]=Math.min(e,m[0]),p[0]=Math.max(e,p[0]),e=a[d+1],m[1]=Math.min(e,m[1]),p[1]=Math.max(e,p[1]),e=a[d+2],m[2]=Math.min(e,m[2]),p[2]=Math.max(e,p[2])}}this.bbMin=m,this.bbMax=p;const M=r(h(),this.bbMin,this.bbMax,.5);this.radius=.5*Math.max(Math.max(p[0]-m[0],p[1]-m[1]),p[2]-m[2]);let b=this.radius*this.radius;for(let n=0;n<x.length;++n){d=x.at(n);const t=a[d]-M[0],i=a[d+1]-M[1],e=a[d+2]-M[2],s=t*t+i*i+e*e;if(s<=b)continue;const r=Math.sqrt(s),h=.5*(r-this.radius);this.radius=this.radius+h,b=this.radius*this.radius;const c=h/r;M[0]+=t*c,M[1]+=i*c,M[2]+=e*c}this.center=M,x.clear()}getChildren(){if(this._children||a(this.bbMin,this.bbMax)<=1)return this._children;const t=r(h(),this.bbMin,this.bbMax,.5),i=this.primitiveIndices.length,e=new Uint8Array(i),n=new Array(8);for(let r=0;r<8;++r)n[r]=0;const{data:s,size:c,indices:l}=this.position;for(let r=0;r<i;++r){let i=0;const h=this._numIndexPerPrimitive*this.primitiveIndices[r];let a=c*l[h],o=s[a],u=s[a+1],d=s[a+2];for(let t=1;t<this._numIndexPerPrimitive;++t){a=c*l[h+t];const i=s[a],e=s[a+1],n=s[a+2];i<o&&(o=i),e<u&&(u=e),n<d&&(d=n)}o<t[0]&&(i|=1),u<t[1]&&(i|=2),d<t[2]&&(i|=4),e[r]=i,++n[i]}let o=0;for(let r=0;r<8;++r)n[r]>0&&++o;if(o<2)return;const u=new Array(8);for(let r=0;r<8;++r)u[r]=n[r]>0?new Uint32Array(n[r]):void 0;for(let r=0;r<8;++r)n[r]=0;for(let r=0;r<i;++r){const t=e[r];u[t][n[t]++]=this.primitiveIndices[r]}this._children=new Array;for(let r=0;r<8;++r)void 0!==u[r]&&this._children.push(new p(u[r],this._numIndexPerPrimitive,this.position));return this._children}static prune(){x.prune()}}t("o",p);const x=new e({deallocator:null});new d(m),new d((()=>{return t?{p0:s(t.p0),p1:s(t.p1),p2:s(t.p2)}:{p0:h(),p1:h(),p2:h()};var t}));const M=h(),b=h()}}}));
