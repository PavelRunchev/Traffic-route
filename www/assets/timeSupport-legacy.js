System.register(["./index-legacy.js","./featureConversionUtils-legacy.js","./OptimizedGeometry-legacy.js","./json-legacy.js"],(function(e,t){"use strict";var n,i,r,s,l,o,a,u,c,f,m,p,y,h,R,g,S,d,x,w,v,G,I,M,_,b,P,N,j,T,F,A,O,U,E,Z,q,z;return{setters:[e=>{n=e.eZ,i=e.iP,r=e.G,s=e.aC,l=e.iQ,o=e.ac,a=e.e_,u=e.q,c=e.d1,f=e.cJ,m=e.c5,p=e.iR,y=e.aG,h=e.ec,R=e.Y,g=e.a1,S=e.a2,d=e.b6,x=e.iS,w=e.aI,v=e.cw,G=e._,I=e.iT,M=e.iU,_=e.iV,b=e.iW,P=e.s,N=e.cC},e=>{j=e.h,T=e.a,F=e.I,A=e.x,O=e.$,U=e.H,E=e.U,Z=e.K},e=>{q=e.e},e=>{z=e.t}],execute:function(){e({I:function(e){if(R(e))return!0;if(g(e)){for(const t of e.rings){if(5!==t.length)return!1;if(t[0][0]!==t[1][0]||t[0][0]!==t[4][0]||t[2][0]!==t[3][0]||t[0][1]!==t[3][1]||t[0][1]!==t[4][1]||t[1][1]!==t[2][1])return!1}return!0}return!1},P:async function(e,t,n){const{spatialRel:i,geometry:r}=e;if(r){if(!function(e){return null!=e&&!0===fe.spatialRelationship[e]}(i))throw new P(ue,"Unsupported query spatial relationship",{query:e});if(f(r.spatialReference)&&f(n)){if(!function(e){return null!=e&&!0===fe.queryGeometry[N(e)]}(r))throw new P(ue,"Unsupported query geometry type",{query:e});if(!function(e){return null!=e&&!0===fe.layerGeometry[e]}(t))throw new P(ue,"Unsupported layer geometry type",{query:e});if(e.outSR)return Q(e.geometry?.spatialReference,e.outSR)}}},S:async function(e,t,n){const{outFields:i,orderByFields:r,groupByFieldsForStatistics:s,outStatistics:l}=e;if(i)for(let o=0;o<i.length;o++)i[o]=i[o].trim();if(r)for(let o=0;o<r.length;o++)r[o]=r[o].trim();if(s)for(let o=0;o<s.length;o++)s[o]=s[o].trim();if(l)for(let o=0;o<l.length;o++)l[o].onStatisticField&&(l[o].onStatisticField=l[o].onStatisticField.trim());return e.geometry&&!e.outSR&&(e.outSR=e.geometry.spatialReference),re(e,t,n)},a:W,b:re,c:function(e,t,n,i){return te.push(e,t,n,i)},h:function(e){return e&&Y in e?JSON.parse(JSON.stringify(e,D)):e},j:ee,n:async function(e,t){if(!e)return null;const n=t.featureAdapter,{startTimeField:i,endTimeField:r}=e;let s=Number.POSITIVE_INFINITY,l=Number.NEGATIVE_INFINITY;if(i&&r)await t.forEach((e=>{const t=n.getAttribute(e,i),o=n.getAttribute(e,r);null==t||isNaN(t)||(s=Math.min(s,t)),null==o||isNaN(o)||(l=Math.max(l,o))}));else{const e=i||r;await t.forEach((t=>{const i=n.getAttribute(t,e);null==i||isNaN(i)||(s=Math.min(s,i),l=Math.max(l,i))}))}return{start:s,end:l}},t:function(e,t,n){if(!t||!e)return null;const{startTimeField:i,endTimeField:r}=e;if(!i&&!r)return null;const{start:s,end:l}=t;if(null===s&&null===l)return null;if(void 0===s&&void 0===l)return()=>!1;const o=n.getAttributeAsTimestamp?.bind(n)??n.getAttribute.bind(n);return i&&r?function(e,t,n,i,r){return null!=i&&null!=r?s=>{const l=e(s,t),o=e(s,n);return(null==l||l<=r)&&(null==o||o>=i)}:null!=i?t=>{const r=e(t,n);return null==r||r>=i}:null!=r?n=>{const i=e(n,t);return null==i||i<=r}:void 0}(o,i,r,s,l):function(e,t,n,i){return null!=n&&null!=i&&n===i?i=>e(i,t)===n:null!=n&&null!=i?r=>{const s=e(r,t);return null!=s&&s>=n&&s<=i}:null!=n?i=>{const r=e(i,t);return null!=r&&r>=n}:null!=i?n=>{const r=e(n,t);return null!=r&&r<=i}:void 0}(o,i||r,s,l)},v:function(e,n,i,r,s){if(g(n)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e)){const e=Z(new q,n,!1,!1);return Promise.resolve((t=>function(e,t,n,i){return oe(e,t,n,i.coords[0],i.coords[1])}(e,!1,!1,t)))}if(g(n)&&"esriGeometryMultipoint"===i){const t=Z(new q,n,!1,!1);if("esriSpatialRelContains"===e)return Promise.resolve((e=>function(e,t,n,i,r,s){const l=le(r,s),{coords:o,lengths:a}=i;if(!a)return!1;for(let u=0,c=0;u<a.length;u++,c+=l)if(!oe(e,t,n,o[c],o[c+1]))return!1;return!0}(t,!1,!1,e,r,s)))}if(R(n)&&"esriGeometryPoint"===i&&("esriSpatialRelIntersects"===e||"esriSpatialRelContains"===e))return Promise.resolve((e=>_(n,W(i,r,s,e))));if(R(n)&&"esriGeometryMultipoint"===i&&"esriSpatialRelContains"===e)return Promise.resolve((e=>b(n,W(i,r,s,e))));if(R(n)&&"esriSpatialRelIntersects"===e){const e=function(e){return"mesh"===e?I:M(e)}(i);return Promise.resolve((t=>e(n,W(i,r,s,t))))}return G((()=>t.import("./geometryEngineJSON-legacy.js")),void 0,t.meta.url).then((t=>{const l=t[ce[e]].bind(null,n.spatialReference,n);return e=>l(W(i,r,s,e))}))},x:Q,y:function(e,t,n,i=e.hasZ,r=e.hasM){if(null==t)return null;const s=e.hasZ&&i,l=e.hasM&&r;if(n){const o=T(V,t,e.hasZ,e.hasM,"esriGeometryPoint",n,i,r);return A(o,s,l)}return A(t,s,l)}});const C=new q,J=new q,V=new q,B={esriGeometryPoint:A,esriGeometryPolyline:O,esriGeometryPolygon:U,esriGeometryMultipoint:E};function W(e,t,n,i,r,s,l=t,o=n){const a=t&&l,u=n&&o,c=null!=i?"coords"in i?i:i.geometry:null;if(null==c)return null;if(r){let i=j(J,c,t,n,e,r,l,o);return s&&(i=T(V,i,a,u,e,s)),B[e]?.(i,a,u)??null}if(s){const i=T(V,c,t,n,e,s,l,o);return B[e]?.(i,a,u)??null}return F(C,c,t,n,l,o),B[e]?.(C,a,u)??null}const Y="_geVersion",D=(e,t)=>e!==Y?t:void 0,K=[0,0];function $(e,t){if(!t)return null;if("x"in t){const n={x:0,y:0};return[n.x,n.y]=e(t.x,t.y,K),null!=t.z&&(n.z=t.z),null!=t.m&&(n.m=t.m),n}if("xmin"in t){const n={xmin:0,ymin:0,xmax:0,ymax:0};return[n.xmin,n.ymin]=e(t.xmin,t.ymin,K),[n.xmax,n.ymax]=e(t.xmax,t.ymax,K),t.hasZ&&(n.zmin=t.zmin,n.zmax=t.zmax,n.hasZ=!0),t.hasM&&(n.mmin=t.mmin,n.mmax=t.mmax,n.hasM=!0),n}return"rings"in t?{rings:k(t.rings,e),hasM:t.hasM,hasZ:t.hasZ}:"paths"in t?{paths:k(t.paths,e),hasM:t.hasM,hasZ:t.hasZ}:"points"in t?{points:H(t.points,e),hasM:t.hasM,hasZ:t.hasZ}:null}function k(e,t){const n=[];for(const i of e)n.push(H(i,t));return n}function H(e,t){const n=[];for(const i of e){const e=t(i[0],i[1],[0,0]);n.push(e),i.length>2&&e.push(i[2]),i.length>3&&e.push(i[3])}return n}async function Q(e,t){if(!e||!t)return;const n=Array.isArray(e)?e.map((e=>null!=e.geometry?e.geometry.spatialReference:null)).filter(u):[e];await c(n.map((e=>({source:e,dest:t}))))}const L=$.bind(null,n),X=$.bind(null,i);function ee(e,t,n,i){if(!e)return e;if(n||(n=t,t=e.spatialReference),!f(t)||!f(n)||r(t,n))return e;if(l(t,n)){const t=o(n)?L(e):X(e);return t.spatialReference=n,t}return a(z,[e],t,n,null,i)[0]}const te=new class{constructor(){this._jobs=[],this._timer=null,this._process=this._process.bind(this)}async push(e,t,n,i){if(!e?.length||!t||!n||r(t,n))return e;const l={geometries:e,inSpatialReference:t,outSpatialReference:n,geographicTransformation:i,resolve:s()};return this._jobs.push(l),this._timer??=setTimeout(this._process,10),l.resolve.promise}_process(){this._timer=null;const e=this._jobs.shift();if(!e)return;const{geometries:t,inSpatialReference:n,outSpatialReference:i,resolve:r,geographicTransformation:s}=e;l(n,i)?o(i)?r(t.map(L)):r(t.map(X)):r(a(z,t,n,i,s,null)),this._jobs.length>0&&(this._timer=setTimeout(this._process,10))}},ne=new m({esriSRUnit_Meter:"meters",esriSRUnit_Kilometer:"kilometers",esriSRUnit_Foot:"feet",esriSRUnit_StatuteMile:"miles",esriSRUnit_NauticalMile:"nautical-miles",esriSRUnit_USNauticalMile:"us-nautical-miles"}),ie=e("g",Object.freeze({}));async function re(e,n,i){if(!e)return null;let{where:r}=e;if(e.where=r=r?.trim(),(!r||/^1 *= *1$/.test(r)||n&&n===r)&&(e.where=null),!e.geometry)return e;let s=await async function(e){const{distance:n,units:i}=e,r=e.geometry;if(null==n||"vertexAttributes"in r)return r;const s=r.spatialReference,l=i?ne.fromJSON(i):x(s),a=s&&(w(s)||o(s))?r:await Q(s,v).then((()=>ee(r,v)));return(await async function(){return(await G((()=>t.import("./geometryEngineJSON-legacy.js")),void 0,t.meta.url)).geodesicBuffer}())(a.spatialReference,a,n,l)}(e);if(e.distance=0,e.units=null,"esriSpatialRelEnvelopeIntersects"===e.spatialRel){const{spatialReference:t}=e.geometry;s=p(s),s.spatialReference=t}if(s){await Q(s.spatialReference,i),s=function(e,t){const n=e.spatialReference;return se(e,t)&&R(e)?{spatialReference:n,rings:[[[e.xmin,e.ymin],[e.xmin,e.ymax],[e.xmax,e.ymax],[e.xmax,e.ymin],[e.xmin,e.ymin]]]}:e}(s,i);const t=(await y(h(s)))[0];if(null==t)throw ie;const n="quantizationParameters"in e&&e.quantizationParameters?.tolerance||"maxAllowableOffset"in e&&e.maxAllowableOffset||0,r=n&&se(s,i)?{densificationStep:8*n}:void 0,l=t.toJSON(),o=ee(l,l.spatialReference,i,r);if(!o)throw ie;o.spatialReference=i,e.geometry=o}return e}function se(e,t){if(!e)return!1;const n=e.spatialReference;return(R(e)||g(e)||S(e))&&!r(n,t)&&!d(n,t)}function le(e,t){return e?t?4:3:t?3:2}function oe(e,t,n,i,r){if(!e)return!1;const s=le(t,n),{coords:l,lengths:o}=e;let a=!1,u=0;for(const c of o)a=ae(a,l,s,u,c,i,r),u+=c*s;return a}function ae(e,t,n,i,r,s,l){let o=e,a=i;for(let u=i,c=i+r*n;u<c;u+=n){a=u+n,a===c&&(a=i);const e=t[u],r=t[u+1],f=t[a],m=t[a+1];(r<l&&m>=l||m<l&&r>=l)&&e+(l-r)/(m-r)*(f-e)<s&&(o=!o)}return o}const ue="unsupported-query",ce={esriSpatialRelIntersects:"intersects",esriSpatialRelContains:"contains",esriSpatialRelCrosses:"crosses",esriSpatialRelDisjoint:"disjoint",esriSpatialRelEnvelopeIntersects:"intersects",esriSpatialRelIndexIntersects:null,esriSpatialRelOverlaps:"overlaps",esriSpatialRelTouches:"touches",esriSpatialRelWithin:"within",esriSpatialRelRelation:null},fe={spatialRelationship:{esriSpatialRelIntersects:!0,esriSpatialRelContains:!0,esriSpatialRelWithin:!0,esriSpatialRelCrosses:!0,esriSpatialRelDisjoint:!0,esriSpatialRelTouches:!0,esriSpatialRelOverlaps:!0,esriSpatialRelEnvelopeIntersects:!0,esriSpatialRelIndexIntersects:!1,esriSpatialRelRelation:!1},queryGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!0},layerGeometry:{esriGeometryPoint:!0,esriGeometryMultipoint:!0,esriGeometryPolyline:!0,esriGeometryPolygon:!0,esriGeometryEnvelope:!1}}}}}));
