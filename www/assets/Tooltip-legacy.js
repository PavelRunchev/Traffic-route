System.register(["./Theme-legacy.js"],(function(e,t){"use strict";var i,s,o,r,l,n,a,h,p,u;return{setters:[e=>{i=e.b,s=e.i,o=e.ak,r=e.al,l=e.c,n=e.h,a=e.a6,h=e.a3,p=e.ad,u=e.am}],execute:function(){class t extends i{_beforeChanged(){super._beforeChanged(),(this.isDirty("pointerBaseWidth")||this.isDirty("cornerRadius")||this.isDirty("pointerLength")||this.isDirty("pointerX")||this.isDirty("pointerY")||this.isDirty("width")||this.isDirty("height"))&&(this._clear=!0)}_changed(){if(super._changed(),this._clear){this.markDirtyBounds();let e=this.width(),t=this.height();if(e>0&&t>0){let i=this.get("cornerRadius",8);i=u(i,0,Math.min(e/2,t/2));let s=this.get("pointerX",0),o=this.get("pointerY",0),r=this.get("pointerBaseWidth",15)/2,l=0,n=0,a=0,h=(s-l)*(t-n)-(o-n)*(e-l),p=(s-a)*(0-t)-(o-t)*(e-a);const g=this._display;if(g.moveTo(i,0),h>0&&p>0){let t=Math.round(u(s,i+r,e-r-i));o=u(o,-1/0,0),g.lineTo(t-r,0),g.lineTo(s,o),g.lineTo(t+r,0)}if(g.lineTo(e-i,0),g.arcTo(e,0,e,i,i),h>0&&p<0){let l=Math.round(u(o,i+r,t-r-i));s=u(s,e,1/0),g.lineTo(e,i),g.lineTo(e,Math.max(l-r,i)),g.lineTo(s,o),g.lineTo(e,l+r)}if(g.lineTo(e,t-i),g.arcTo(e,t,e-i,t,i),h<0&&p<0){let l=Math.round(u(s,i+r,e-r-i));o=u(o,t,1/0),g.lineTo(e-i,t),g.lineTo(l+r,t),g.lineTo(s,o),g.lineTo(l-r,t)}if(g.lineTo(i,t),g.arcTo(0,t,0,t-i,i),h<0&&p>0){let e=Math.round(u(o,i+r,t-i-r));s=u(s,-1/0,0),g.lineTo(0,t-i),g.lineTo(0,e+r),g.lineTo(s,o),g.lineTo(0,Math.max(e-r,i))}g.lineTo(0,i),g.arcTo(0,0,i,0,i),g.closePath()}}}}Object.defineProperty(t,"className",{enumerable:!0,configurable:!0,writable:!0,value:"PointedRectangle"}),Object.defineProperty(t,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:i.classNames.concat([t.className])});class g extends s{constructor(e,t,i,s=[]){super(e,t,i,s),Object.defineProperty(this,"_fx",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_fy",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_label",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_fillDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_strokeDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_labelDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_w",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_h",{enumerable:!0,configurable:!0,writable:!0,value:0}),Object.defineProperty(this,"_keepHoverDp",{enumerable:!0,configurable:!0,writable:!0,value:void 0}),Object.defineProperty(this,"_htmlContentHovered",{enumerable:!0,configurable:!0,writable:!0,value:!1})}_afterNew(){this._settings.themeTags=o(this._settings.themeTags,["tooltip"]),super._afterNew(),this.set("background",t.new(this._root,{themeTags:["tooltip","background"]})),this._label=this.children.push(r.new(this._root,{})),this._disposers.push(this._label.events.on("boundschanged",(()=>{this._updateBackground()}))),this._disposers.push(this.on("bounds",(()=>{this._updateBackground()}))),this._updateTextColor(),this._root.tooltipContainer.children.push(this),this.hide(0),this._disposers.push(this.label.onPrivate("htmlElement",(e=>{e&&(l(e,"pointerover",(e=>{this._htmlContentHovered=!0})),l(e,"pointerout",(e=>{this._htmlContentHovered=!1})))}))),this._root._tooltips.push(this)}get label(){return this._label}dispose(){super.dispose(),n(this._root._tooltips,this)}_updateChildren(){super._updateChildren(),(this.isDirty("pointerOrientation")||this.isPrivateDirty("minWidth")||this.isPrivateDirty("minHeight"))&&this.get("background")._markDirtyKey("width"),null!=this.get("labelText")&&this.label.set("text",this.get("labelText")),null!=this.get("labelHTML")&&this.label.set("html",this.get("labelHTML"))}_changed(){if(super._changed(),(this.isDirty("pointTo")||this.isDirty("pointerOrientation"))&&this._updateBackground(),this.isDirty("tooltipTarget")&&this.updateBackgroundColor(),this.isDirty("keepTargetHover"))if(this.get("keepTargetHover")){const e=this.get("background");this._keepHoverDp=new a([e.events.on("pointerover",(e=>{let t=this.get("tooltipTarget");t&&(t.parent&&t.parent.getPrivate("tooltipTarget")==t&&(t=t.parent),t.hover())})),e.events.on("pointerout",(e=>{let t=this.get("tooltipTarget");t&&(t.parent&&t.parent.getPrivate("tooltipTarget")==t&&(t=t.parent),this._htmlContentHovered||t.unhover())}))]),this.label.onPrivate("htmlElement",(t=>{this._keepHoverDp&&t&&this._keepHoverDp.disposers.push(l(t,"pointerleave",(t=>{const i=this.root._renderer.getEvent(t);e.events.dispatch("pointerout",{type:"pointerout",originalEvent:i.event,point:i.point,simulated:!1,target:e})})))}))}else this._keepHoverDp&&(this._keepHoverDp.dispose(),this._keepHoverDp=void 0)}_onShow(){super._onShow(),this.updateBackgroundColor()}updateBackgroundColor(){let e=this.get("tooltipTarget");const t=this.get("background");let i,s;e&&t&&(i=e.get("fill"),s=e.get("stroke"),null==i&&(i=s),this.get("getFillFromSprite")&&(this._fillDp&&this._fillDp.dispose(),null!=i&&t.set("fill",i),this._fillDp=e.on("fill",(e=>{null!=e&&(t.set("fill",e),this._updateTextColor(e))})),this._disposers.push(this._fillDp)),this.get("getStrokeFromSprite")&&(this._strokeDp&&this._strokeDp.dispose(),null!=i&&t.set("stroke",i),this._strokeDp=e.on("fill",(e=>{null!=e&&t.set("stroke",e)})),this._disposers.push(this._strokeDp)),this.get("getLabelFillFromSprite")&&(this._labelDp&&this._labelDp.dispose(),null!=i&&this.label.set("fill",i),this._labelDp=e.on("fill",(e=>{null!=e&&this.label.set("fill",e)})),this._disposers.push(this._labelDp))),this._updateTextColor(i)}_updateTextColor(e){this.get("autoTextColor")&&(null==e&&(e=this.get("background").get("fill")),null==e&&(e=this._root.interfaceColors.get("background")),e instanceof h&&this.label.set("fill",h.alternative(e,this._root.interfaceColors.get("alternativeText"),this._root.interfaceColors.get("text"))))}_setDataItem(e){super._setDataItem(e),this.label._setDataItem(e)}_updateBackground(){super.updateBackground();const e=this._root.container;if(e){let i=.5,s=.5,o=this.get("centerX");o instanceof p&&(i=o.value);let r=this.get("centerY");r instanceof p&&(s=r.value);let l=e.width(),n=e.height(),a=this.parent,h=0,g=0;if(a){h=a.x(),g=a.y();const e=a.get("layerMargin");e&&(h+=e.left||0,g+=e.top||0,l+=(e.left||0)+(e.right||0),n+=(e.top||0)+(e.bottom||0))}const d=this.get("bounds",{left:-h,top:-g,right:l-h,bottom:n-g});this._updateBounds();let c=this.width(),b=this.height();0===c&&(c=this._w),0===b&&(b=this._h);let _=this.get("pointTo",{x:l/2,y:n/2}),f=_.x,m=_.y,v=this.get("pointerOrientation"),T=this.get("background"),y=0,D=0,k=0;T instanceof t&&(y=T.get("pointerLength",0),D=T.get("strokeWidth",0)/2,k=D,T.set("width",c),T.set("height",b));let w=0,x=0,P=d.right-d.left,C=d.bottom-d.top;"horizontal"==v||"left"==v||"right"==v?(D=0,"horizontal"==v?f>d.left+P/2?(f-=c*(1-i)+y,k*=-1):f+=c*i+y:"left"==v?f+=c*(1-i)+y:(f-=c*i+y,k*=-1)):(k=0,"vertical"==v?m>d.top+b/2+y?m-=b*(1-s)+y:(m+=b*s+y,D*=-1):"down"==v?m-=b*(1-s)+y:(m+=b*s+y,D*=-1)),f=u(f,d.left+c*i,d.left+P-c*(1-i))+k,m=u(m,d.top+b*s,d.top+C-b*(1-s))-D,w=_.x-f+c*i+k,x=_.y-m+b*s-D,this._fx=f,this._fy=m;const O=this.get("animationDuration",0);if(O>0&&this.get("visible")&&this.get("opacity")>.1){const e=this.get("animationEasing");this.animate({key:"x",to:f,duration:O,easing:e}),this.animate({key:"y",to:m,duration:O,easing:e})}else this.set("x",f),this.set("y",m);T instanceof t&&(T.set("pointerX",w),T.set("pointerY",x)),c>0&&(this._w=c),b>0&&(this._h=b)}}}e("u",g),Object.defineProperty(g,"className",{enumerable:!0,configurable:!0,writable:!0,value:"Tooltip"}),Object.defineProperty(g,"classNames",{enumerable:!0,configurable:!0,writable:!0,value:s.classNames.concat([g.className])})}}}));
