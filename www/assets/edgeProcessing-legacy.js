System.register(["./deduplicate-legacy.js","./InterleavedLayout-legacy.js","./VertexAttribute-legacy.js","./enums-legacy.js","./VertexElementDescriptor-legacy.js","./index-legacy.js"],(function(t,e){"use strict";var n,o,r,s,i,c,a,l,f,u,g,N,d,I,m,S,p,O,h,E;return{setters:[t=>{n=t.e},t=>{o=t.H},t=>{r=t.e},t=>{s=t.C},t=>{i=t.t},t=>{c=t.gI,a=t.iX,l=t.h2,f=t.eT,u=t.cR,g=t.cp,N=t.h0,d=t.iY,I=t.cq,m=t.cS,S=t.cs,p=t.ct,O=t.a8,h=t.cV,E=t.iq}],execute:function(){function e(t,e=0){const n=t.stride;return Array.from(t.fields.keys()).map((o=>{const r=t.fields.get(o),s=r.constructor.ElementCount,c=A(r.constructor.ElementType),a=r.offset,l=!(!r.optional||!r.optional.glNormalized);return new i(o,s,c,a,n,l,e)}))}function A(t){const e=T[t];if(e)return e;throw new Error("BufferType not supported in WebGL")}t({a:P,f:function(t){const e=Z(t.data,t.skipDeduplicate,t.indices,t.indicesLength);return tt.updateSettings(t.writerSettings),et.updateSettings(t.writerSettings),P(e,tt,et)},u:Z});const T={u8:s.UNSIGNED_BYTE,u16:s.UNSIGNED_SHORT,u32:s.UNSIGNED_INT,i8:s.BYTE,i16:s.SHORT,i32:s.INT,f32:s.FLOAT},w=t("I",o().vec3f(r.POSITION).u16(r.COMPONENTINDEX));e(o().vec2u8(r.SIDENESS));const y=o().vec3f(r.POSITION0).vec3f(r.POSITION1).vec2i16(r.NORMALCOMPRESSED).u16(r.COMPONENTINDEX).u8(r.VARIANTOFFSET,{glNormalized:!0}).u8(r.VARIANTSTROKE).u8(r.VARIANTEXTENSION,{glNormalized:!0}),v=o().vec3f(r.POSITION0).vec3f(r.POSITION1).vec2i16(r.NORMALCOMPRESSED).vec2i16(r.NORMAL2COMPRESSED).u16(r.COMPONENTINDEX).u8(r.VARIANTOFFSET,{glNormalized:!0}).u8(r.VARIANTSTROKE).u8(r.VARIANTEXTENSION,{glNormalized:!0});new Map([[r.POSITION0,0],[r.POSITION1,1],[r.COMPONENTINDEX,2],[r.VARIANTOFFSET,3],[r.VARIANTSTROKE,4],[r.VARIANTEXTENSION,5],[r.NORMALCOMPRESSED,6],[r.NORMAL2COMPRESSED,7],[r.SIDENESS,8]]);const M=-1;var R;function P(t,e,n,o=_){const r=t.vertices.position,s=t.vertices.componentIndex,i=c(o.anglePlanar),N=c(o.angleSignificantEdge),d=Math.cos(N),I=Math.cos(i),m=F.edge,S=m.position0,p=m.position1,O=m.faceNormal0,h=m.faceNormal1,E=C(t),A=function(t){const e=t.faces.length/3,n=t.faces,o=t.neighbors;let r=0;for(let c=0;c<e;c++){const t=o[3*c],e=o[3*c+1],s=o[3*c+2],i=n[3*c],a=n[3*c+1],l=n[3*c+2];r+=t===M||i<a?1:0,r+=e===M||a<l?1:0,r+=s===M||l<i?1:0}const s=new Int32Array(4*r);let i=0;for(let c=0;c<e;c++){const t=o[3*c],e=o[3*c+1],r=o[3*c+2],a=n[3*c],l=n[3*c+1],f=n[3*c+2];(t===M||a<l)&&(s[i++]=a,s[i++]=l,s[i++]=c,s[i++]=t),(e===M||l<f)&&(s[i++]=l,s[i++]=f,s[i++]=c,s[i++]=e),(r===M||f<a)&&(s[i++]=f,s[i++]=a,s[i++]=c,s[i++]=r)}return s}(t),T=A.length/4,w=e.allocate(T);let y=0;const v=T,R=n.allocate(v);let P=0,b=0,x=0;const B=a(0,T),W=new Float32Array(T);W.forEach(((t,e,n)=>{r.getVec(A[4*e],S),r.getVec(A[4*e+1],p),n[e]=l(S,p)})),B.sort(((t,e)=>W[e]-W[t]));const X=new Array,U=new Array;for(let c=0;c<T;c++){const t=B[c],o=W[t],a=A[4*t],l=A[4*t+1],N=A[4*t+2],T=A[4*t+3],v=T===M;if(r.getVec(a,S),r.getVec(l,p),v)f(O,E[3*N],E[3*N+1],E[3*N+2]),u(h,O),m.componentIndex=s.get(a),m.cosAngle=g(O,h);else{if(f(O,E[3*N],E[3*N+1],E[3*N+2]),f(h,E[3*T],E[3*T+1],E[3*T+2]),m.componentIndex=s.get(a),m.cosAngle=g(O,h),D(m,I))continue;m.cosAngle<-.9999&&u(h,O)}b+=o,x++,v||V(m,d)?(e.write(w,y++,m),X.push(o)):L(m,i)&&(n.write(R,P++,m),U.push(o))}const H=new Float32Array(X.reverse()),j=new Float32Array(U.reverse());return{regular:{instancesData:e.trim(w,y),lodInfo:{lengths:H}},silhouette:{instancesData:n.trim(R,P),lodInfo:{lengths:j}},averageEdgeLength:b/x}}function V(t,e){return t.cosAngle<e}function D(t,e){return t.cosAngle>e}function L(t,e){const n=N(t.cosAngle),o=F.fwd,r=F.ortho;return d(o,t.position1,t.position0),n*(g(I(r,t.faceNormal0,t.faceNormal1),o)>0?-1:1)>e}function C(t){const e=t.faces.length/3,n=t.vertices.position,o=t.faces,r=b.v0,s=b.v1,i=b.v2,c=new Float32Array(3*e);for(let a=0;a<e;a++){const t=o[3*a],e=o[3*a+1],l=o[3*a+2];n.getVec(t,r),n.getVec(e,s),n.getVec(l,i),m(s,s,r),m(i,i,r),I(r,s,i),S(r,r),c[3*a]=r[0],c[3*a+1]=r[1],c[3*a+2]=r[2]}return c}!function(t){t[t.SOLID=0]="SOLID",t[t.SKETCH=1]="SKETCH"}(R||(R={}));const F={edge:{position0:p(),position1:p(),faceNormal0:p(),faceNormal1:p(),componentIndex:0,cosAngle:0},ortho:p(),fwd:p()},b={v0:p(),v1:p(),v2:p()},_={anglePlanar:4,angleSignificantEdge:35};function x(t,e,n){const o=e/3,r=new Uint32Array(n+1),s=new Uint32Array(n+1),i=(t,e)=>{t<e?r[t+1]++:s[e+1]++};for(let S=0;S<o;S++){const e=t[3*S],n=t[3*S+1],o=t[3*S+2];i(e,n),i(n,o),i(o,e)}let c=0,a=0;for(let S=0;S<n;S++){const t=r[S+1],e=s[S+1];r[S+1]=c,s[S+1]=a,c+=t,a+=e}const l=new Uint32Array(6*o),f=r[n],u=(t,e,n)=>{if(t<e){const o=r[t+1]++;l[2*o]=e,l[2*o+1]=n}else{const o=s[e+1]++;l[2*f+2*o]=t,l[2*f+2*o+1]=n}};for(let S=0;S<o;S++){const e=t[3*S],n=t[3*S+1],o=t[3*S+2];u(e,n,S),u(n,o,S),u(o,e,S)}const g=(t,e)=>{const n=2*t,o=e-t;for(let r=1;r<o;r++){const t=l[n+2*r],e=l[n+2*r+1];let o=r-1;for(;o>=0&&l[n+2*o]>t;o--)l[n+2*o+2]=l[n+2*o],l[n+2*o+3]=l[n+2*o+1];l[n+2*o+2]=t,l[n+2*o+3]=e}};for(let S=0;S<n;S++)g(r[S],r[S+1]),g(f+s[S],f+s[S+1]);const N=new Int32Array(3*o),d=(e,n)=>e===t[3*n]?0:e===t[3*n+1]?1:e===t[3*n+2]?2:-1,I=(t,e)=>{const n=d(t,e);N[3*e+n]=-1},m=(t,e,n,o)=>{const r=d(t,e);N[3*e+r]=o;const s=d(n,o);N[3*o+s]=e};for(let S=0;S<n;S++){let t=r[S];const e=r[S+1];let n=s[S];const o=s[S+1];for(;t<e&&n<o;){const e=l[2*t],o=l[2*f+2*n];e===o?(m(S,l[2*t+1],o,l[2*f+2*n+1]),t++,n++):e<o?(I(S,l[2*t+1]),t++):(I(o,l[2*f+2*n+1]),n++)}for(;t<e;)I(S,l[2*t+1]),t++;for(;n<o;)I(l[2*f+2*n],l[2*f+2*n+1]),n++}return N}function B(t,e,n,o,r,s=2){const i=1/(Math.abs(n)+Math.abs(o)+Math.abs(r)),c=n*i,a=o*i,l=r<=0?(c>=0?1:-1)*(1-Math.abs(a)):c,f=r<=0?(a>=0?1:-1)*(1-Math.abs(c)):a,u=e*s;t[u]=W(l),t[u+1]=W(f)}function W(t){return O(Math.round(32767*t),-32767,32767)}class X{updateSettings(t){this.settings=t,this._edgeHashFunction=t.reducedPrecision?K:z}write(t,e,n){const o=this._edgeHashFunction(n);Q.seed=o;const r=Q.getIntRange(0,255),s=Q.getIntRange(0,this.settings.variants-1),i=Q.getFloat(),c=255*(.5*function(t,e){const n=t<0?-1:1;return Math.abs(t)**e*n}(-(1-Math.min(i/.7,1))+Math.max(0,i-.7)/(1-.7),1.2)+.5);t.position0.setVec(e,n.position0),t.position1.setVec(e,n.position1),t.componentIndex.set(e,n.componentIndex),t.variantOffset.set(e,r),t.variantStroke.set(e,s),t.variantExtension.set(e,c)}trim(t,e){return t.slice(0,e)}}const U=new Float32Array(6),H=new Uint32Array(U.buffer),j=new Uint32Array(1);function z(t){const e=U;e[0]=t.position0[0],e[1]=t.position0[1],e[2]=t.position0[2],e[3]=t.position1[0],e[4]=t.position1[1],e[5]=t.position1[2],j[0]=5381;for(let n=0;n<H.length;n++)j[0]=31*j[0]+H[n];return j[0]}function K(t){const e=U;e[0]=k(t.position0[0]),e[1]=k(t.position0[1]),e[2]=k(t.position0[2]),e[3]=k(t.position1[0]),e[4]=k(t.position1[1]),e[5]=k(t.position1[2]),j[0]=5381;for(let n=0;n<H.length;n++)j[0]=31*j[0]+H[n];return j[0]}const G=1e4;function k(t){return Math.round(t*G)/G}class q{constructor(){this._commonWriter=new X}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return y.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n),h(J,n.faceNormal0,n.faceNormal1),S(J,J);const{typedBuffer:o,typedBufferStride:r}=t.normalCompressed;B(o,e,J[0],J[1],J[2],r)}trim(t,e){return this._commonWriter.trim(t,e)}}q.Layout=y,q.glLayout=e(y,1);class Y{constructor(){this._commonWriter=new X}updateSettings(t){this._commonWriter.updateSettings(t)}allocate(t){return v.createBuffer(t)}write(t,e,n){this._commonWriter.write(t,e,n);{const{typedBuffer:o,typedBufferStride:r}=t.normalCompressed;B(o,e,n.faceNormal0[0],n.faceNormal0[1],n.faceNormal0[2],r)}{const{typedBuffer:o,typedBufferStride:r}=t.normal2Compressed;B(o,e,n.faceNormal1[0],n.faceNormal1[1],n.faceNormal1[2],r)}}trim(t,e){return this._commonWriter.trim(t,e)}}Y.Layout=v,Y.glLayout=e(v,1);const J=p(),Q=new E;function Z(t,e,o,r){if(e){const e=x(o,r,t.count);return new $(o,r,e,t)}const s=n(t.buffer,t.stride/4,{originalIndices:o,originalIndicesLength:r}),i=x(s.indices,r,s.uniqueCount);return{faces:s.indices,facesLength:s.indices.length,neighbors:i,vertices:w.createView(s.buffer)}}class ${constructor(t,e,n,o){this.faces=t,this.facesLength=e,this.neighbors=n,this.vertices=o}}const tt=new q,et=new Y,nt=o().vec3f(r.POSITION0).vec3f(r.POSITION1),ot=o().vec3f(r.POSITION0).vec3f(r.POSITION1).u16(r.COMPONENTINDEX);t({d:nt,m:ot})}}}));
