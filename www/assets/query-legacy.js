System.register(["./index-legacy.js","./pbfQueryUtils-legacy.js"],(function(t,e){"use strict";var n,r,i,a,u,l,o,s;return{setters:[t=>{n=t.eb,r=t.ao,i=t.aG,a=t.X,u=t.bG,l=t.dI,o=t.cC},t=>{s=t.t}],execute:function(){function e(t){const n={};for(const r in t){if("declaredClass"===r)continue;const i=t[r];if(null!=i&&"function"!=typeof i)if(Array.isArray(i)){n[r]=[];for(let t=0;t<i.length;t++)n[r][t]=e(i[t])}else"object"==typeof i?i.toJSON&&(n[r]=JSON.stringify(i)):n[r]=i}return n}t({S:function(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{count:0}}):d(t,e,"json",n,{returnIdsOnly:!0,returnCountOnly:!0})},c:async function(t,e,r,i){const a=null!=e.timeExtent&&e.timeExtent.isEmpty?{data:{features:[]}}:await d(t,e,"json",i);return n(e,r,a.data),a},d:f,f:async function(t,e,n,r){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:n.createFeatureResult()};const i=await f(t,e,r),a=i;return a.data=s(i.data,n),a},p:function(t,e,n){return null!=e.timeExtent&&e.timeExtent.isEmpty?Promise.resolve({data:{objectIds:[]}}):d(t,e,"json",n,{returnIdsOnly:!0})},t:e,x:async function(t,e,n){if(null!=e.timeExtent&&e.timeExtent.isEmpty)return{data:{count:0,extent:null}};const r=await d(t,e,"json",n,{returnExtentOnly:!0,returnCountOnly:!0}),i=r.data;if(i.hasOwnProperty("extent"))return r;if(i.features)throw new Error(c);if(i.hasOwnProperty("count"))throw new Error(c);return r}});const c="Layer does not support extent calculation.";function y(t,e){const n=t.geometry,r=t.toJSON();delete r.compactGeometryEnabled,delete r.defaultSpatialReferenceEnabled;const i=r;let a,u,s;if(null!=n&&(u=n.spatialReference,s=l(u),i.geometryType=o(n),i.geometry=function(t,e){if(e&&"extent"===t.type)return`${t.xmin},${t.ymin},${t.xmax},${t.ymax}`;if(e&&"point"===t.type)return`${t.x},${t.y}`;const n=t.toJSON();return delete n.spatialReference,JSON.stringify(n)}(n,t.compactGeometryEnabled),i.inSR=s),r.groupByFieldsForStatistics&&(i.groupByFieldsForStatistics=r.groupByFieldsForStatistics.join(",")),r.objectIds&&(i.objectIds=r.objectIds.join(",")),r.orderByFields&&(i.orderByFields=r.orderByFields.join(",")),!r.outFields||!r.returnDistinctValues&&(e?.returnCountOnly||e?.returnExtentOnly||e?.returnIdsOnly)?delete i.outFields:r.outFields.includes("*")?i.outFields="*":i.outFields=r.outFields.join(","),r.outSR?(i.outSR=l(r.outSR),a=t.outSpatialReference):n&&(r.returnGeometry||r.returnCentroid)&&(i.outSR=i.inSR,a=u),r.returnGeometry&&delete r.returnGeometry,r.outStatistics&&(i.outStatistics=JSON.stringify(r.outStatistics)),r.fullText&&(i.fullText=JSON.stringify(r.fullText)),r.pixelSize&&(i.pixelSize=JSON.stringify(r.pixelSize)),r.quantizationParameters&&(t.defaultSpatialReferenceEnabled&&null!=u&&null!=t.quantizationParameters?.extent&&u.equals(t.quantizationParameters.extent.spatialReference)&&delete r.quantizationParameters.extent.spatialReference,i.quantizationParameters=JSON.stringify(r.quantizationParameters)),r.parameterValues&&(i.parameterValues=JSON.stringify(r.parameterValues)),r.rangeValues&&(i.rangeValues=JSON.stringify(r.rangeValues)),r.dynamicDataSource&&(i.layer=JSON.stringify({source:r.dynamicDataSource}),delete r.dynamicDataSource),r.timeExtent){const t=r.timeExtent,{start:e,end:n}=t;null==e&&null==n||(i.time=e===n?e:`${e??"null"},${n??"null"}`),delete r.timeExtent}return t.defaultSpatialReferenceEnabled&&null!=u&&null!=a&&u.equals(a)&&(i.defaultSR=i.inSR,delete i.inSR,delete i.outSR),i}function f(t,e,n){return d(t,e,"pbf",n)}async function d(t,n,l,o={},s={}){const c="string"==typeof t?r(t):t,f=n.geometry?[n.geometry]:[],d=await i(f,null,{signal:o.signal}),m=d?.[0];null!=m&&((n=n.clone()).geometry=m);const p=e({...c.query,f:l,...s,...y(n,s)});return a(u(c.path,function(t,e){return null!=t.formatOf3DObjects&&!(e.returnCountOnly||e.returnExtentOnly||e.returnIdsOnly)}(n,s)?"query3d":"query"),{...o,responseType:"pbf"===l?"array-buffer":"json",query:{...p,...o.query}})}}}}));
