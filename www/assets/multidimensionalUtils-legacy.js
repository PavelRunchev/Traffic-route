System.register(["./index-legacy.js"],(function(e,n){"use strict";var t,i,a,s,r,l,o;return{setters:[e=>{t=e.x,i=e.y,a=e.eR,s=e.z,r=e.bX,l=e.ax,o=e.q}],execute:function(){var n;e({D:function(e,n){let t=0;const i=e[0].variableName,a=[...n.variables].sort(((e,n)=>e.name>n.name?1:-1));for(let s=0;s<a.length;s++){const n=a[s],r=[...n.dimensions].sort(((e,n)=>e.name>n.name?-1:1));if(n.name!==i){t+=r.map((e=>D(e))).reduce(((e,n)=>e*n));continue}const l=r.map((e=>D(e))),o=r.length;for(let i=0;i<o;i++){const n=e.find((e=>e.dimensionName===r[i].name));if(null==n)return null;const a=y(n.values[0],r[i]);if(-1===a)return null;l.shift(),t+=i===o-1?a:a*l.reduce(((e,n)=>e*n))}break}return t},a:function(e,n,t){let i=e;if(n&&(n=[...n].sort(((e,n)=>e.dimensionName<n.dimensionName?-1:1))).forEach((({dimensionName:e,values:n,isSlice:t})=>{n.length&&(i=i.filter((i=>{const a=i.multidimensionalDefinition.find((n=>n.dimensionName===e));if(null==a)return!1;const s=a.values[0];return"number"==typeof s?"number"==typeof n[0]?n.includes(s):n.some((e=>e[0]<=s&&e[1]>=s)):"number"==typeof n[0]?n.some((e=>s[0]<=e&&s[1]>=e)):t?n.some((e=>e[0]===s[0]&&e[0]===s[1])):n.some((e=>e[0]>=s[0]&&e[0]<=s[1]||e[1]>=s[0]&&e[1]<=s[1]||e[0]<s[0]&&e[1]>s[1]))})))})),i.length&&null!=t?.start&&null!=t.end){const e=t.start.getTime(),n=t.end.getTime(),a=i[0].multidimensionalDefinition.findIndex((e=>"StdTime"===e.dimensionName));a>-1&&(i=i.filter((t=>{const i=t.multidimensionalDefinition[a].values[0];return e<=i&&n>=i})))}return i.map((e=>e.sliceId))},d:function(e,n={}){const t=b(e,n);if(!t)return null;const i=[],{dimensions:a,name:s}=t;if(0===a.length)return[new m({variableName:s,dimensionName:"",values:[],isSlice:!0})];for(let r=0;r<a.length;r++){const e=v(a[r],n.multidimensionalSubset,s);if(!e)return null;const{values:t,extent:l}=e;let o=t?.[0]??l[0];"stdz"===e.name.toLowerCase()&&!e.hasRanges&&Math.abs(l[1])<=Math.abs(l[0])&&(o=t?.length?t[t.length-1]:l[1]),i.push(new m({variableName:s,dimensionName:e.name,values:[o],isSlice:!n.useRangeForRangedDimensionInfo||!!e.hasRanges}))}return i},f:b,g:function(e,n){if(null==n||null==e)return null;let t=n.variables.map((e=>({...e})));return e?.variables?.length&&(t=t.filter((({name:n})=>e.variables.includes(n))),t.forEach((n=>{n.dimensions=n.dimensions.map((t=>v(t,e,n.name))).filter(o)}))),t},h:function(e){return!!e?.length&&e.some((e=>{if(null==e.values)return!0;const n=e.values.length;return 0===n||n>1||!e.isSlice&&Array.isArray(e.values[0])}))},i:function(e,n){const t=[];let i=0;return(n?e.variables.filter((e=>e.name.toLowerCase()===n.toLowerCase())):[...e.variables].sort(((e,n)=>e.name>n.name?1:-1))).forEach((e=>{const n=[],a=[...e.dimensions].sort(((e,n)=>e.name>n.name?-1:1));c(e.name,a,n),n.forEach((e=>{t.push({...e,sliceId:i++})}))})),t},m:function(e,n){if(null==e)return{isOutside:!1};const{geometry:t,timeExtent:i,multidimensionalDefinition:a}=n;let s=null;if(null!=i&&(s=function(e,n){const t=e.dimensions.find((({name:e})=>"StdTime"===e));if(null==t||null==n.start&&null==n.end)return n;n=n.clone();const{start:i,end:a}=n.toJSON(),s=i===a?[i]:null!=i&&null!=a?[i,a]:[i??a];return 2===s.length&&t?.extent.length&&(s[0]=Math.max(s[0],t.extent[0]),s[1]=Math.min(s[1],t.extent[1]??t.extent[0]),s[1]<s[0])||g([new m({variableName:"",dimensionName:"StdTime",isSlice:1===s.length,values:s})],e,!0)?null:(n.start=new Date(s[0]),n.end=new Date(s[1]??s[0]),n)}(e,i),null==s))return{isOutside:!0};const{areaOfInterest:r}=e;if(r&&t){const e="point"===t.type?t:"extent"===t.type?t.center:"polygon"===t.type?t.centroid:null;if(e&&!r.contains(e))return{isOutside:!0}}return null!=a&&a.length&&g(a,e,!0)?{isOutside:!0}:{isOutside:!1,intersection:{geometry:t,timeExtent:s,multidimensionalDefinition:a}}},o:g});let u=n=class extends r{constructor(e){super(e),this.variableName=null,this.dimensionName=null,this.values=[],this.isSlice=!1}clone(){return new n({variableName:this.variableName,dimensionName:this.dimensionName,values:l(this.values),isSlice:this.isSlice})}};t([i({type:String,json:{write:!0}})],u.prototype,"variableName",void 0),t([i({type:String,json:{write:!0}})],u.prototype,"dimensionName",void 0),t([i({type:a.array(a.oneOf([a.native(Number),a.array(a.native(Number))])),json:{write:!0}})],u.prototype,"values",void 0),t([i({type:Boolean,json:{write:!0}})],u.prototype,"isSlice",void 0),u=n=t([s("esri.layers.support.DimensionalDefinition")],u);const m=e("p",u);function c(e,n,t){const i=n.shift();if(0===t.length){const e=[];t.push({sliceId:-1,multidimensionalDefinition:e})}const a=t.length;for(let s=0;s<a;s++){const n=t.shift().multidimensionalDefinition;i.values?.forEach((a=>{t.push({sliceId:-1,multidimensionalDefinition:[...n,{variableName:e,dimensionName:i.name,values:[a]}]})}))}n.length&&c(e,n,t)}function d(e,n){return Array.isArray(e)?n[0]===n[1]?e[0]===n[0]||e[1]===n[0]:e[0]>=n[0]&&e[0]<=n[1]&&e[1]>=n[0]&&e[1]<=n[1]:e>=n[0]&&e<=n[1]}function f(e,n){return e[0]<=n[0]&&e[1]>=n[0]||e[0]<=n[1]&&e[1]>=n[1]||e[0]>=n[0]&&e[1]<=n[1]}function h(e){return 1===e.length?[e[0],e[0]]:[e[0],e[e.length-1]]}function v(e,n,t){if(!n?.subsetDefinitions?.length)return e;let i;if(t){const{variables:a}=n;if(a.length&&!a.includes(t))return null;const s=n.subsetDefinitions.find((n=>n.dimensionName===e.name&&n.variableName===t));if(!s?.values?.length)return e;i=h(s.values)}else{const t=n.dimensions.find((({name:n})=>n===e.name));i=t?.extent}const a=i;if(!a?.length)return e;const s=e.values.filter((e=>d(e,a)));return{...e,extent:[...a],values:s}}function g(e,n,t){if(!n?.subsetDefinitions?.length)return!1;const{variables:i}=n;if(i.length&&e.some((({variableName:e})=>e&&!i.includes(e))))return!0;for(let a=0;a<e.length;a++){const i=e[a],s=n.subsetDefinitions.find((e=>(""===i.variableName||e.variableName===i.variableName)&&e.dimensionName===i.dimensionName));if(s?.values.length){const e=h(s.values);if(i.isSlice||2!==i.values.length||Array.isArray(i.values[0])||i.values[0]===i.values[1]||!t){if(i.values.some((n=>!d(n,e))))return!0}else if(!f(i.values,e))return!0}}return!1}function b(e,n={}){const{multidimensionalInfo:t,keyProperties:i}=e;if(null==t)return null;const{variableName:a,multidimensionalSubset:s,multidimensionalDefinition:r}=n,l=null!=r?r[0]?.variableName:null,o=a||l||i?.DefaultVariable;let{variables:u}=t;return s?.variables?.length&&(u=u.filter((({name:e})=>s.variables.includes(e)))),o?u.find((({name:e})=>e===o))??u[0]:u[0]}function y(e,n){const{values:t}=n;if(t?.length){const n=Array.isArray(t[0]),i=Array.isArray(e);return n!==i?-1:n&&i?t.findIndex((n=>n[0]===e[0]&&n[1]===e[1])):t.indexOf(e)}const{extent:i}=n;if(Array.isArray(e)||e<i[0]||e>i[1])return-1;const a=n.interval||1;if("ISO8601"!==n.unit)return Math.round((e-i[0])/a);const s=i[0];let r=-1;switch(n.intervalUnit?.toLowerCase()||"seconds"){case"seconds":r=Math.round((e-s)/1e3/a);break;case"minutes":r=Math.round((e-s)/6e4/a);break;case"hours":r=Math.round((e-s)/36e5/a);break;case"days":r=Math.round((e-s)/864e5/a);break;case"months":{const n=new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear(),t=new Date(s).getUTCMonth(),i=new Date(e).getUTCMonth();r=0===n?i-t:i+11-t+12*(n-1)}break;case"years":r=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/a);break;case"decades":r=Math.round((new Date(e).getUTCFullYear()-new Date(s).getUTCFullYear())/10/a)}return r}function D(e){let n=e.values?.length;if(n)return n;const{extent:t,unit:i}=e,a=e.interval||1,s=t?t[1]-t[0]:0;if("ISO8601"!==i)return Math.round(s/a);switch(e.intervalUnit?.toLowerCase()??"seconds"){case"seconds":n=Math.round(s/1e3/a);break;case"minutes":n=Math.round(s/6e4/a);break;case"hours":n=Math.round(s/36e5/a);break;case"days":n=Math.round(s/864e5/a);break;case"months":{const e=new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear(),i=new Date(t[0]).getUTCMonth(),a=new Date(t[1]).getUTCMonth();n=0===e?a-i+1:a+11-i+12*(e-1)+1}break;case"years":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/a);break;case"decades":n=Math.round((new Date(t[1]).getUTCFullYear()-new Date(t[0]).getUTCFullYear())/10/a);break;default:n=0}return n}}}}));
